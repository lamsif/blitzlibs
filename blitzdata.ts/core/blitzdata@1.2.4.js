(function(I,M){typeof exports=="object"&&typeof module<"u"?M(exports):typeof define=="function"&&define.amd?define(["exports"],M):(I=typeof globalThis<"u"?globalThis:I||self,M(I.BlitzData={}))})(this,function(I){"use strict";var rs=Object.defineProperty;var ns=(I,M,K)=>M in I?rs(I,M,{enumerable:!0,configurable:!0,writable:!0,value:K}):I[M]=K;var m=(I,M,K)=>(ns(I,typeof M!="symbol"?M+"":M,K),K);const nt=class nt{constructor(){m(this,"_method");m(this,"_url");m(this,"_headers",{});m(this,"_body");m(this,"_signal")}static create(){const t=new nt;return nt._globalHeaders&&t.headers(nt._globalHeaders),t}static globalHeaders(t){nt._globalHeaders=t}method(t){return this._method=t,this}url(t){return this._url=t,this}header(t,e){return this._headers[t]=e,this}headers(t){for(const e in t)this.header(e,t[e]);return this}body(t){return this._body=t,this}signal(t){return this._signal=t,this}async send(){const t=await fetch(this._url,{method:this._method,headers:this._headers,body:this._body?this._body instanceof FormData?this._body:JSON.stringify(this._body):void 0,signal:this._signal?this._signal:void 0});if(!t.ok)throw new Error(`HTTP request failed with status code ${t.status}. Status text: ${t.statusText} and response: ${await t.text()}`);return await t.json()}async get(){return await this.method("GET").send()}async post(){return await this.method("POST").send()}};m(nt,"_globalHeaders",{});let M=nt;class K{constructor(t,e){m(this,"name");m(this,"options");m(this,"cursors",{readURL:0});this.name=t,this.options=e}getNextReadURL(){this.cursors.readURL>=this.options.readURL.length&&(this.cursors.readURL=0);const t=this.options.readURL[this.cursors.readURL];return this.cursors.readURL++,t}}class Gt{constructor(){m(this,"clusters",{})}register(t,e){this.clusters[t]=new K(t,e)}get(t){if(!Array.isArray(t)){if(this.clusters[t]===void 0)throw new Error(`cluster "${t}" not found.`);return this.clusters[t]}const e={};for(const r of t)e[r]=this.get(r);return e}names(){return Object.keys(this.clusters)}all(){return this.clusters}toArray(){return Object.values(this.clusters)}random(){const t=this.names(),e=t[Math.floor(Math.random()*t.length)];return this.get(e)}}const Le=(n,t)=>t.some(e=>n instanceof e);let Kt,Zt;function Fe(){return Kt||(Kt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ne(){return Zt||(Zt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const te=new WeakMap,xt=new WeakMap,ee=new WeakMap,At=new WeakMap,Pt=new WeakMap;function Je(n){const t=new Promise((e,r)=>{const a=()=>{n.removeEventListener("success",s),n.removeEventListener("error",i)},s=()=>{e(q(n.result)),a()},i=()=>{r(n.error),a()};n.addEventListener("success",s),n.addEventListener("error",i)});return t.then(e=>{e instanceof IDBCursor&&te.set(e,n)}).catch(()=>{}),Pt.set(t,n),t}function Re(n){if(xt.has(n))return;const t=new Promise((e,r)=>{const a=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",i),n.removeEventListener("abort",i)},s=()=>{e(),a()},i=()=>{r(n.error||new DOMException("AbortError","AbortError")),a()};n.addEventListener("complete",s),n.addEventListener("error",i),n.addEventListener("abort",i)});xt.set(n,t)}let Et={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return xt.get(n);if(t==="objectStoreNames")return n.objectStoreNames||ee.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return q(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function $e(n){Et=n(Et)}function He(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(jt(this),t,...e);return ee.set(r,t.sort?t.sort():[t]),q(r)}:Ne().includes(n)?function(...t){return n.apply(jt(this),t),q(te.get(this))}:function(...t){return q(n.apply(jt(this),t))}}function Ye(n){return typeof n=="function"?He(n):(n instanceof IDBTransaction&&Re(n),Le(n,Fe())?new Proxy(n,Et):n)}function q(n){if(n instanceof IDBRequest)return Je(n);if(At.has(n))return At.get(n);const t=Ye(n);return t!==n&&(At.set(n,t),Pt.set(t,n)),t}const jt=n=>Pt.get(n);function Ct(n,t,{blocked:e,upgrade:r,blocking:a,terminated:s}={}){const i=indexedDB.open(n,t),o=q(i);return r&&i.addEventListener("upgradeneeded",d=>{r(q(i.result),d.oldVersion,d.newVersion,q(i.transaction),d)}),e&&i.addEventListener("blocked",d=>e(d.oldVersion,d.newVersion,d)),o.then(d=>{s&&d.addEventListener("close",()=>s()),a&&d.addEventListener("versionchange",c=>a(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}function kt(n,{blocked:t}={}){const e=indexedDB.deleteDatabase(n);return t&&e.addEventListener("blocked",r=>t(r.oldVersion,r)),q(e).then(()=>{})}const Be=["get","getKey","getAll","getAllKeys","count"],Ve=["put","add","delete","clear"],Wt=new Map;function re(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Wt.get(t))return Wt.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,a=Ve.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(a||Be.includes(e)))return;const s=async function(i,...o){const d=this.transaction(i,a?"readwrite":"readonly");let c=d.store;return r&&(c=c.index(o.shift())),(await Promise.all([c[e](...o),a&&d.done]))[0]};return Wt.set(t,s),s}$e(n=>({...n,get:(t,e,r)=>re(t,e)||n.get(t,e,r),has:(t,e)=>!!re(t,e)||n.has(t,e)}));const T={name:"bd-queue",store:"jobs",timeIndex:"time",objectIndex:"object"};var p=(n=>(n.Pending="pending",n.Completed="completed",n.Failed="failed",n.Conflict="conflict",n))(p||{}),Z=(n=>(n.Success="success",n.Exception="exception",n.Failed="failed",n.Conflict="conflict",n))(Z||{}),x=(n=>(n.Add="add",n.Edit="edit",n.Delete="delete",n))(x||{}),B="SharedWorker"in globalThis,qe=class{constructor(n){m(this,"ActualWorker");this.ActualWorker=n}get onmessage(){var n;return B?(n=this.ActualWorker)==null?void 0:n.port.onmessage:this.ActualWorker.onmessage}set onmessage(n){B?this.ActualWorker.port.onmessage=n:this.ActualWorker.onmessage=n}get onmessageerror(){var n;return B?(n=this.ActualWorker)==null?void 0:n.port.onmessageerror:this.ActualWorker.onmessageerror}set onmessageerror(n){B?this.ActualWorker.port.onmessageerror=n:this.ActualWorker.onmessageerror=n}start(){var n;if(B)return(n=this.ActualWorker)==null?void 0:n.port.start()}postMessage(n,t){var e;return B?(e=this.ActualWorker)==null?void 0:e.port.postMessage(n,t):this.ActualWorker.postMessage(n,t)}terminate(){var n;return B?(n=this.ActualWorker)==null?void 0:n.port.close():this.ActualWorker.terminate()}close(){return this.terminate()}get port(){return B?this.ActualWorker.port:this.ActualWorker}get onerror(){return this.ActualWorker.onerror}set onerror(n){this.ActualWorker.onerror=n}addEventListener(n,t,e){var r;return B&&n!=="error"?(r=this.ActualWorker)==null?void 0:r.port.addEventListener(n,t,e):this.ActualWorker.addEventListener(n,t,e)}removeEventListener(n,t,e){var r;return B&&n!=="error"?(r=this.ActualWorker)==null?void 0:r.port.removeEventListener(n,t,e):this.ActualWorker.removeEventListener(n,t,e)}dispatchEvent(n){return this.ActualWorker.dispatchEvent(n)}},Qe=class extends qe{constructor(n,t){let e;B?e=new SharedWorker(n,t):e=new Worker(n,t),super(e)}};function Xe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ne={};/*! crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */(function(n){(function(t){t(typeof DO_NOT_EXPORT_CRC>"u"?n:{})})(function(t){t.version="1.2.2";function e(){for(var g=0,R=new Array(256),b=0;b!=256;++b)g=b,g=g&1?-306674912^g>>>1:g>>>1,g=g&1?-306674912^g>>>1:g>>>1,g=g&1?-306674912^g>>>1:g>>>1,g=g&1?-306674912^g>>>1:g>>>1,g=g&1?-306674912^g>>>1:g>>>1,g=g&1?-306674912^g>>>1:g>>>1,g=g&1?-306674912^g>>>1:g>>>1,g=g&1?-306674912^g>>>1:g>>>1,R[b]=g;return typeof Int32Array<"u"?new Int32Array(R):R}var r=e();function a(g){var R=0,b=0,D=0,O=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(D=0;D!=256;++D)O[D]=g[D];for(D=0;D!=256;++D)for(b=g[D],R=256+D;R<4096;R+=256)b=O[R]=b>>>8^g[b&255];var k=[];for(D=1;D!=16;++D)k[D-1]=typeof Int32Array<"u"?O.subarray(D*256,D*256+256):O.slice(D*256,D*256+256);return k}var s=a(r),i=s[0],o=s[1],d=s[2],c=s[3],u=s[4],l=s[5],h=s[6],f=s[7],w=s[8],v=s[9],z=s[10],A=s[11],L=s[12],U=s[13],at=s[14];function Qt(g,R){for(var b=R^-1,D=0,O=g.length;D<O;)b=b>>>8^r[(b^g.charCodeAt(D++))&255];return~b}function ts(g,R){for(var b=R^-1,D=g.length-15,O=0;O<D;)b=at[g[O++]^b&255]^U[g[O++]^b>>8&255]^L[g[O++]^b>>16&255]^A[g[O++]^b>>>24]^z[g[O++]]^v[g[O++]]^w[g[O++]]^f[g[O++]]^h[g[O++]]^l[g[O++]]^u[g[O++]]^c[g[O++]]^d[g[O++]]^o[g[O++]]^i[g[O++]]^r[g[O++]];for(D+=15;O<D;)b=b>>>8^r[(b^g[O++])&255];return~b}function es(g,R){for(var b=R^-1,D=0,O=g.length,k=0,Xt=0;D<O;)k=g.charCodeAt(D++),k<128?b=b>>>8^r[(b^k)&255]:k<2048?(b=b>>>8^r[(b^(192|k>>6&31))&255],b=b>>>8^r[(b^(128|k&63))&255]):k>=55296&&k<57344?(k=(k&1023)+64,Xt=g.charCodeAt(D++)&1023,b=b>>>8^r[(b^(240|k>>8&7))&255],b=b>>>8^r[(b^(128|k>>2&63))&255],b=b>>>8^r[(b^(128|Xt>>6&15|(k&3)<<4))&255],b=b>>>8^r[(b^(128|Xt&63))&255]):(b=b>>>8^r[(b^(224|k>>12&15))&255],b=b>>>8^r[(b^(128|k>>6&63))&255],b=b>>>8^r[(b^(128|k&63))&255]);return~b}t.table=r,t.bstr=Qt,t.buf=ts,t.str=es})})(ne);function st(){return Math.floor((new Date().getTime()-new Date("2021-01-01T00:00:00Z").getTime())/1e3)}function ut(n){return st().toString(36)+"-"+ne.str(JSON.stringify(n)).toString(36)}function ae(n){return new Promise(t=>{setTimeout(t,n)})}class ${constructor(t){m(this,"action");m(this,"blitzstamp");m(this,"hash");m(this,"hashAlgo");m(this,"blitzID");m(this,"userhash");m(this,"model");m(this,"data");var e;this.action=t.action,this.blitzstamp=t.blitzstamp??st(),this.hash=t.hash??ut(t.data===void 0?{blitzID:t.blitzID,milliseconds:new Date().getTime(),rand:Math.random()}:{...t.data,blitzID:t.blitzID,milliseconds:new Date().getTime(),rand:Math.random()}),this.hashAlgo=t.hashAlgo??"b-crc32",this.blitzID=t.blitzID??((e=t.data)==null?void 0:e._blitzID)??this.hash,this.model=t.model,this.data=t.data??{},this.userhash=t.userhash}toObject(){return{action:this.action,blitzstamp:this.blitzstamp,hash:this.hash,hashAlgo:this.hashAlgo,blitzID:this.blitzID,model:this.model,data:this.data,userhash:this.userhash}}clone(){return new $({action:this.action,model:this.model,blitzID:this.blitzID,blitzstamp:this.blitzstamp,data:this.data,hash:this.hash,hashAlgo:this.hashAlgo,userhash:this.userhash})}static fromObject(t){var e;return new $({action:t.action,blitzstamp:t.blitzstamp,hash:t.hash,hashAlgo:t.hashAlgo,blitzID:t.blitzID??((e=t.data)==null?void 0:e._blitzID)??t.blitzID,model:t.model,data:t.data,userhash:t.userhash})}}var C=(n=>(n.Success="success",n.Notice="notice",n.Error="error",n.Exception="exception",n))(C||{});class Y{constructor(t,e,r,a=null,s){m(this,"blitzID");m(this,"hash");m(this,"message");m(this,"conflict");m(this,"replicaUrl",null);m(this,"status");this.blitzID=t,this.hash=e,this.status=r,this.message=a,this.conflict=s}setReplicaUrl(t){this.replicaUrl=t}isConflict(){return typeof this.conflict<"u"&&this.conflict!==null}}class bt extends Array{get(t){return this.find(e=>e.hash===t)}has(t){return this.some(e=>e.hash===t)}isSuccessful(t){var e;if(t){const r=(e=this.get(t))==null?void 0:e.status;return r?r==="success"||r==="notice":!1}return this.every(r=>r.status)}isFailed(t){var e;if(t){const r=(e=this.get(t))==null?void 0:e.status;return r?r==="error":!0}return this.every(r=>!r.status)}successful(){return new bt(...this.filter(t=>t.status))}failed(){return new bt(...this.filter(t=>!t.status))}}class j{static createListEndpoint(t,e,r){var i;const a=`${j.sanitizeBaseUrl(t)}api/list/${e}.json`,s=new URLSearchParams;return new URL(t).origin!==window.location.origin&&s.append("enableCors","1"),s.append("fkOptions",JSON.stringify({_userID:"blitzID"})),(i=r.conditions)!=null&&i.length&&s.append("conditions",JSON.stringify(r.conditions)),r.limit&&s.append("limit",r.limit.toString()),r.customSort&&s.append("customSort",r.customSort),r.customSortDirection&&s.append("customSortDirection",r.customSortDirection),r.pagination&&s.append("pagination",r.pagination.toString()),r.var&&r.var.length>0&&s.append("var",JSON.stringify(r.var)),r.manyToMany&&s.append("manyToMany",r.manyToMany),`${a}?${s.toString()}`}static createGetEndpoint(t,e,r,a){const s=`${j.sanitizeBaseUrl(t)}api/list/${e}/_blitzID/${r}.json`,i=new URLSearchParams;return new URL(t).origin!==window.location.origin&&i.append("enableCors","1"),i.append("fkOptions",JSON.stringify({_userID:"blitzID"})),a.var&&a.var.length>0&&i.append("var",JSON.stringify(a.var)),a.manyToMany&&i.append("manyToMany",a.manyToMany),`${s}?${i.toString()}`}static createPostEndpoint(t){return`${j.sanitizeBaseUrl(t)}api/post.json`}static createPingEndpoint(t){return`${j.sanitizeBaseUrl(t)}api/ping.json`}static createListLogsEndpoint(t){var s,i;const e=t.type==="delete"?"listDeletedLogs":"listLogs",r=t.model?`${j.sanitizeBaseUrl(t.baseUrl)}api/${e}/${t.model}.json`:`${j.sanitizeBaseUrl(t.baseUrl)}api/${e}.json`,a=new URLSearchParams;return((s=t.query)==null?void 0:s.from)!==void 0&&a.append("from",t.query.from.toString()),(i=t.query)!=null&&i.models&&!t.model&&a.append("models",JSON.stringify(t.query.models)),`${r}?${a.toString()}`}static createUploaderEndpoint(t){const e=new URL(t).origin!==window.location.origin?"?enableCors=1":"";return`${j.sanitizeBaseUrl(t)}uploader/index`+e}static createVideoUploaderEndpoint(t,e){const r=new URL(t).origin!==window.location.origin?"?enableCors=1":"",a=(r?r+"&":"?")+`filename=${e}`;return`${j.sanitizeBaseUrl(t)}uploadervideo/index`+a}static createFileUploaderEndpoint(t){const e=new URL(t).origin!==window.location.origin?"?enableCors=1":"";return`${j.sanitizeBaseUrl(t)}uploaderfile/index`+e}static sanitizeBaseUrl(t){const e=new URL(t);if(!e.origin||!e.pathname||!e.protocol.match(/^https?:$/))throw new Error(`Supplied base URL is invalid: ${t}`);return e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),e.toString()}}class tt{static async list(t,e){if(!t.endpoint&&!t.fullUrl)throw new Error("Either baseUrl or fullUrl must be provided.");const r=await M.create().url(t.fullUrl?t.fullUrl:j.createListEndpoint(t.endpoint.baseUrl,t.endpoint.modelName,t.endpoint.query)).signal(e).get();if(!Array.isArray(r.items)&&Array.isArray(r.errors))throw new Error(r.errors.map(a=>(a==null?void 0:a.message)??a).join(" | "));return r.items??[]}static async get(t,e){const r=await M.create().url(j.createGetEndpoint(t.baseUrl,t.modelName,t.blitzID,t.query)).signal(e).get();if(!Array.isArray(r.items)&&Array.isArray(r.errors))throw new Error(r.errors.map(a=>(a==null?void 0:a.message)??a).join(" | "));return r.items??[]}static async post(t){const e=await M.create().url(j.createPostEndpoint(t.baseUrl)).body(t.transactions).post();if((typeof e.error=="string"||e.errors instanceof Array)&&!(e.results instanceof Object))throw new Error(e.error??e.errors.join(" | "));return e}static async listLogs(t){const e=await M.create().url(j.createListLogsEndpoint(t)).get();if(!(e.transactions instanceof Array)&&(typeof e.error=="string"||e.errors instanceof Array))throw new Error(e.error??e.errors.map(r=>(r==null?void 0:r.message)??r).join(" | "));return{transactions:e.transactions,userID:e.userID,userhash:e.userhash,lastTimestamp:e.lastTimestamp}}static upload(t){const e=new FormData;return e.append("image",t.image),M.create().url(j.createUploaderEndpoint(t.baseUrl)).body(e).header("Accept","application/json").post()}static async uploadVideo(t){const e=new FormData;e.append("fileToUpload",t.video);const r=t.video.name.split("."),a=r.length>1?"."+r.pop():"",s=crypto.randomUUID()+a,i=await M.create().url(j.createVideoUploaderEndpoint(t.baseUrl,s)).body(e).header("Accept","application/json").post();if(!i||!i.s)throw new Error("Video upload failed: "+((i==null?void 0:i.error)??"Unknown error!"));return{url:i.url.video,thumbnail:i.url.thumb,"tn-oq":i.url.tnoq}}static async uploadFile(t){const e=new FormData;e.append("files[]",t.file);const r=await M.create().url(j.createFileUploaderEndpoint(t.baseUrl)).body(e).header("Accept","application/json").post();if(!r||!r.s)throw new Error("File upload failed: "+((r==null?void 0:r.error)??"Unknown error!"));return{url:r.files.url}}static async ping({baseUrl:t}){return await M.create().url(j.createPingEndpoint(t)).get()}}class Ut{constructor(){m(this,"_query");m(this,"_model");m(this,"_type")}static create(){return new Ut}query(t){return this._query=t,this}model(t){return this._model=t,this}type(t){return this._type=t,this}async perform(){const t=y.clusterManager.toArray().map(a=>a.getNextReadURL()),e=await Promise.all(t.map(a=>tt.listLogs({baseUrl:a,query:this._query,model:this._model,type:this._type})));return{transactions:[].concat(...e.map(a=>a.transactions)).filter((a,s,i)=>i.findIndex(o=>o.hash===a.hash)===s).filter(a=>typeof a=="object"&&!Array.isArray(a)),userID:e[0].userID,userhash:e[0].userhash,lastTimestamp:e[0].lastTimestamp}}}class Lt{async ping(){const t=await this.openConnection(),e=["sync_transactions","evaluated_transactions"];for(const r of e)if(!t.objectStoreNames.contains(r))return t.close(),console.log(`There's missing stores, recreating the database. Available stores: ${t.objectStoreNames}`),await kt("db_master"),await this.ping();t.close()}async openConnection(){return await Ct("db_master",1,{upgrade:(t,e,r,a,s)=>{r===1&&(t.createObjectStore("sync_transactions",{autoIncrement:!1,keyPath:"hash"}),t.createObjectStore("evaluated_transactions",{autoIncrement:!1,keyPath:"hash"}))}})}}class S{static getKey(t){return`BlitzData.${t}`}static get(t){return localStorage.getItem(this.getKey(t))}static set(t,e){localStorage.setItem(this.getKey(t),e)}static has(t){return Object.hasOwn(localStorage,this.getKey(t))}static remove(t){localStorage.removeItem(this.getKey(t))}static clear(){const t=Object.keys(localStorage);for(const e of t)e.startsWith("BlitzData.")&&localStorage.removeItem(e)}static getLastSyncedAt(t){const e=this.get(t?`${t}.lastSyncedAt`:"lastSyncedAt");return e?parseInt(e):null}static setLastSyncedAt(t,e){this.set(e?`${e}.lastSyncedAt`:"lastSyncedAt",t.toString())}static getCurrentUser(){const t=this.get("currentUser");return t?JSON.parse(t):null}static setCurrentUser(t){t?this.set("currentUser",JSON.stringify(t)):this.remove("currentUser")}static getProjectUsers(t){const e=this.get("projectUsers."+t);return e?JSON.parse(e):null}static setProjectUsers(t,e){const r="projectUsers."+t;e?this.set(r,JSON.stringify(e)):this.remove(r)}static getDatabases(){return JSON.parse(this.get("databases")??"[]")}static setDatabases(t){this.set("databases",JSON.stringify(t))}static getListCallLastTimeStamp(t){const e=this.get(`cache.listCall.${t}.lastTimeStamp`);return e?Number(e):null}static setListCallLastTimeStamp(t,e){this.set(`cache.listCall.${t}.lastTimeStamp`,String(e))}}class wt{constructor(){m(this,"client",new Lt)}static create(){return new wt}async all(){const t=await this.client.openConnection(),e=await t.getAll("sync_transactions");return t.close(),e}async put(t){const e=await this.client.openConnection();await e.put("sync_transactions",t),e.close()}async putMultiple(t){for(const e of t)await this.put(e)}async delete(t){const e=await this.client.openConnection();await e.delete("sync_transactions",t),e.close()}}class lt{static create(){return new lt}async run(t,e){if(!navigator.onLine)return;const r=y.options.sync.startDate instanceof Date&&t!=="_Model"?Math.floor(y.options.sync.startDate.getTime()/1e3):0,a=S.getLastSyncedAt(t)??r,{transactions:s,lastTimestamp:i}=await Ut.create().type(e).query({from:a,models:t?[t]:y.options.sync.models??["_Project",...(await J.list()).map(d=>d.getName()).filter(d=>d.startsWith("bdt")&&!["bdt24prszej_appfiles","bdt24prszej_apps"].includes(d))]}).perform(),o=wt.create();await o.putMultiple(s),S.setLastSyncedAt(i??Math.floor(Date.now()/1e3),t),await V.create().run((await o.all()).map(d=>$.fromObject(d))),a!==i&&await this.run(t,e)}async runAtInterval(t){for(;;)await ae(t),await this.run()}}class V{static create(){return new V}async run(t){const e=new bt,r=wt.create(),a={add:1,edit:2,delete:3},s=await new Lt().openConnection();t=t.sort((i,o)=>a[i.action]-a[o.action]);for(const i of t){let o;i.model==="@Model"?i.model="_Model":i.model==="@Project"&&(i.model="_Project");try{if(i.action==="add")o=await this.processAddTransaction(i);else if(i.action==="edit")o=await this.processEditTransaction(i,s);else if(i.action==="delete")o=await this.processDeleteTransaction(i);else throw new Error(`Unknown action "${i.action}" on transaction ${i.hash}`);await s.put("evaluated_transactions",i.toObject())}catch(d){o=new Y(i.blitzID,i.hash,C.Error,d.message)}e.push(o),await r.delete(i.hash)}return s.close(),e}async processAddTransaction(t){var i;const e=await J.get(t.model),r=e.idbClient();if(await r.find(t.hash))return new Y(t.hash,t.hash,C.Error,`Object with ${t.hash} already exists on ${t.model} model.`);const a=e.getClusterManager(),s={_blitzID:t.hash,_blitzstamp:t.blitzstamp.toString(),_sort:t.blitzstamp.toString(),_clusters:a.names(),_editURLs:a.toArray().map(o=>o.options.addURL).flat(),...(()=>{const o={};for(const[d,c]of Object.entries(t.data)){const u=e.getAttributeDetails(d);if(u&&Array.isArray(u.type)&&c!==void 0){const l=typeof c=="string"?JSON.parse(c):c;d.endsWith("_mtm")?o[d]=l.map((f,w)=>({_blitzID:typeof f=="string"?f:f._blitzID,_mtmSort:typeof f=="string"?(l.length-w)*15:f._mtmSort})):o[d]=l}else o[d]=c}return o})()};if(((i=e.haspublishingdate)==null?void 0:i.value)==="1"&&typeof t.data._publishingdate>"u"&&typeof t.blitzstamp=="number"){const o=new Date;o.setTime(t.blitzstamp*1e3+new Date("2021-01-01T00:00:00Z").getTime()),o.setMinutes(o.getMinutes()-o.getTimezoneOffset()),s._publishingdate=o.toISOString().slice(0,19).replace("T"," ")}return!s._userID&&t.userhash&&(s._userID=t.userhash),t.data=s,await r.create(s),new Y(t.hash,t.hash,C.Success)}async processEditTransaction(t,e){var c;const r=await J.get(t.model),a=r.idbClient(),s=Object.keys(t.data);if(s.length!==1)return new Y(t.blitzID,t.hash,C.Error,s.length>1?"Can not edit more than one attribute at once.":"Attribute not provided to perform edit.");if(await e.get("evaluated_transactions",t.hash))return new Y(t.blitzID,t.hash,C.Notice,`Transaction ${t.hash} already processed.`);const i=await a.find(t.blitzID);if(!i)return new Y(t.blitzID,t.hash,C.Notice,`Object with ${t.blitzID} does not exists.`);if(i._savetimestamp&&i._savetimestamp>t.blitzstamp)return new Y(t.blitzID,t.hash,C.Notice,"Old transaction.");const o=s.shift(),d=(c=r.getAttributeDetails(o))==null?void 0:c.type;if(Array.isArray(d))if(Object.hasOwn(t.data[o],"add")){i[o]=i[o]??[];const u=t.data[o].add;o.endsWith("_mtm")?i[o].push({_blitzID:typeof u=="string"?u:u._blitzID,_mtmSort:typeof u=="string"?i[o].length?Math.max(...i[o].map(h=>h._mtmSort))+15:15:u._mtmSort}):i[o].push(u)}else if(Object.hasOwn(t.data[o],"remove")&&Array.isArray(i[o])){const u=t.data[o].remove;o.endsWith("_mtm")?i[o].splice(i[o].findIndex(h=>h._blitzID===u),1):i[o].splice(i[o].findIndex(h=>h===u),1)}else return new Y(t.blitzID,t.hash,C.Error,`Invalid operation for array attribute ${o}.`);else{const u=t.data[o];if(i[o]===u.new)return new Y(t.blitzID,t.hash,C.Notice,"Conflict");i[o]=u.new}return await a.update(i),new Y(t.blitzID,t.hash,C.Success)}async processDeleteTransaction(t){const r=(await J.get(t.model)).idbClient();return await r.find(t.blitzID)?(await r.delete(t.blitzID),new Y(t.blitzID,t.hash,C.Success)):new Y(t.blitzID,t.hash,C.Error,`Object with ${t.blitzID} does not exists.`)}}class Ge{constructor(t){m(this,"_db");this._db=t}async _updateJob(t){var e;return await((e=this._db)==null?void 0:e.put(T.store,t)),t}async _deleteJob(t){var e;await((e=this._db)==null?void 0:e.delete(T.store,t.id))}async _getCompletedReplicatedJobs(t){var s;const e=[],r=(s=this._db)==null?void 0:s.transaction(T.store,"readonly").store;let a=await(r==null?void 0:r.openCursor(null,"next"));for(;a;)a.value.status===p.Completed&&a.value.url!==t.url&&a.value.transaction.action===x.Edit&&a.value.transaction.blitzID===t.transaction.blitzID&&a.value.transaction.hash===t.transaction.hash&&e.push(a.value),a=await a.continue();return e}async _getFutureJobs(t,e){var o;const r=[],a=(o=this._db)==null?void 0:o.transaction(T.store,"readonly").store,s=IDBKeyRange.lowerBound(t.createdAt,!0);let i=await(a==null?void 0:a.index(T.timeIndex).openCursor(s,"next"));for(;i;)i.value.status===p.Conflict&&i.value.url===t.url&&i.value.transaction.action===x.Edit&&i.value.transaction.blitzID===t.transaction.blitzID&&Object.keys(i.value.transaction.data)[0]===e&&r.push(i.value),i=await i.continue();return r}async _mergeWithFutureEditJobs(t,e){var s,i;const r=await this._getFutureJobs(t,e);let a=t;if(r.length>0){const o=r[r.length-1];if(o&&((s=o.transaction.data)==null?void 0:s[e].new)!==void 0&&((i=t.transaction.data)==null?void 0:i[e].prev)!==void 0){const d={[e]:{prev:t.transaction.data[e].prev,new:o.transaction.data[e].new}},c=new Date().getTime();a=await this._updateJob({...t,transaction:{...t.transaction,data:d,blitzstamp:st(),hash:ut({...d,blitzID:t.transaction.blitzID,timestamp:c})},dataHistory:[...t.dataHistory??[],{timestamp:c,type:"conflict-succeeding",data:t.transaction.data}]});for(const u of r)await this._deleteJob(u)}}return a}async prompt(t){var s;if(t.message===void 0)return;const e=Object.keys(t.transaction.data)[0];let r=await this._mergeWithFutureEditJobs(t,e);const a=`There was a conflict.
The data got changed to "${r.message}".
Do you still want to perform your change to "${(s=r.transaction.data)==null?void 0:s[e].new}"?`;confirm(a)?(r=await this.force(r),await y.queue.updateSyncStatus(r,p.Pending)):(await this.revert(r),await y.queue.updateSyncStatus(r,p.Completed)),y.dispatchEvent("queue:conflict",r)}async force(t){var o;const e=Object.keys(t.transaction.data)[0],r=await this._getFutureJobs(t,e),a={[e]:{prev:t.message,new:(o=t.transaction.data)==null?void 0:o[e].new}},s=new Date().getTime(),i=await this._updateJob({...t,status:p.Pending,transaction:{...t.transaction,data:a,blitzstamp:st(),hash:ut({...a,blitzID:t.transaction.blitzID,timestamp:s})},dataHistory:[...t.dataHistory??[],{timestamp:s,type:"conflict-force",data:t.transaction.data}]});await V.create().run([new $({action:"edit",model:i.transaction.model,blitzID:i.transaction.blitzID,data:i.transaction.data})]);for(const d of r)await this._updateJob({...d,status:p.Pending});return i}async revert(t){var i;const e=Object.keys(t.transaction.data)[0],r=new $({action:"edit",model:t.transaction.model,blitzID:t.transaction.blitzID,data:{[e]:{prev:(i=t.transaction.data)==null?void 0:i[e].new,new:t.message}}});await V.create().run([r]);const a=await this._getFutureJobs(t,e),s=await this._getCompletedReplicatedJobs(t);for(const o of[t,...a])await this._deleteJob(o);if(s.length>0){const o=s.map(d=>d.url).filter((d,c,u)=>u.findIndex(l=>l===d)===c);for(const d of o)await y.queue.addJob(d,r.toObject())}}}class Ke{constructor(t){m(this,"_db");this._db=t}async _updateJob(t){var e;return await((e=this._db)==null?void 0:e.put(T.store,t)),t}async _deleteJob(t){var e;await((e=this._db)==null?void 0:e.delete(T.store,t.id))}async _getFutureJobs(t){var i;const e=[],r=(i=this._db)==null?void 0:i.transaction(T.store,"readonly").store,a=IDBKeyRange.lowerBound(t.createdAt,!0);let s=await(r==null?void 0:r.index(T.timeIndex).openCursor(a,"next"));for(;s;)s.value.url===t.url&&s.value.transaction.blitzID===t.transaction.blitzID&&e.push(s.value),s=await s.continue();return e}async retry(t){for(const e of t)await this._updateJob({...e,status:p.Pending})}async revert(t){var r,a;t.sort((s,i)=>s.createdAt-i.createdAt);const e=t[0];if(e){if(e.transaction.action===x.Add){await V.create().run([new $({action:"delete",model:e.transaction.model,blitzID:e.transaction.blitzID})]);const s=await this._getFutureJobs(e);for(const i of[e,...s])await this._deleteJob(i)}else if(e.transaction.action===x.Delete)await this._deleteJob(e),await J.get(e.transaction.model).then(s=>s==null?void 0:s.get(e.transaction.blitzID));else if(e.transaction.action===x.Edit){const s=Object.keys(e.transaction.data??{})[0];if(!s||((r=e.transaction.data)==null?void 0:r[s].new)===void 0||((a=e.transaction.data)==null?void 0:a[s].prev)===void 0)return;const i=new $({action:"edit",model:e.transaction.model,blitzID:e.transaction.blitzID,data:{[s]:{prev:e.transaction.data[s].new,new:e.transaction.data[s].prev}}});await V.create().run([i]);for(const o of t)await this._deleteJob(o)}}}async getAll(){var a;const t={},e=(a=this._db)==null?void 0:a.transaction(T.store,"readonly").store;let r=await(e==null?void 0:e.index(T.timeIndex).openCursor(null,"next"));for(;r;){if(r.value.status!==p.Completed){if(t[r.value.url]||(t[r.value.url]=[]),r.value.transaction.action===x.Add||r.value.transaction.action===x.Delete)t[r.value.url].push([r.value]);else if(r.value.transaction.action===x.Edit){const s=Object.keys(r.value.transaction.data??{})[0],i=r.value.transaction.blitzID,o=t[r.value.url].findIndex(d=>d[0].transaction.action===x.Edit&&d[0].transaction.blitzID===i&&Object.keys(d[0].transaction.data??{})[0]===s);o===-1?t[r.value.url].push([r.value]):t[r.value.url][o].push(r.value)}}r=await r.continue()}return t}}const Ze="/queue-worker.js";class tr{constructor(){m(this,"_db",null);m(this,"conflictHandler",null);m(this,"failedHandler",null)}_handleWorkerMessage(t){var r;const e=t.data.job;e.status===p.Completed?y.dispatchEvent("queue:success",e):e.status===p.Failed?y.dispatchEvent("queue:failure",e):e.status===p.Conflict&&(document.hidden||(r=y.queue.conflictHandler)==null||r.prompt(e)),y._Model.get(e.transaction.model).then(a=>{var s;return(s=a==null?void 0:a.memoryClient().get(e.transaction.blitzID))==null?void 0:s.dispatchEvent("syncStatusChange",e)}),y.queue.updateSyncStatus(e)}async updateSyncStatus(t,e){if(t.transaction.action!==x.Edit)return;const r=await y._Model.get(t.transaction.model),a=r==null?void 0:r.memoryClient().get(t.transaction.blitzID);if(!a)return;const s=Object.keys(t.transaction.data??{})[0];if(!s)return;const i=a[s];if(!(!i||!Object.hasOwn(i,"_syncSignal")))if(e)i._syncSignal.set({status:e});else{const d=(await y.queue.getJobsForObject(t.transaction.blitzID)).filter(f=>{var w;return f.transaction.action===x.Edit&&((w=f.transaction.data)==null?void 0:w[s])!==void 0});let c=p.Pending,u;const l=d.find(f=>f.status===p.Failed),h=d.find(f=>f.status===p.Conflict);l?(c=p.Failed,u=l):h?(c=p.Conflict,u=h):d.every(f=>f.status===p.Completed)&&(c=p.Completed),i._syncSignal.set({status:c,job:u})}}async init(){if(this._db=await Ct(T.name,1,{upgrade:e=>{const r=e.createObjectStore(T.store,{keyPath:"id"});r.createIndex(T.timeIndex,"createdAt"),r.createIndex(T.objectIndex,"transaction.blitzID")}}),!this._db.objectStoreNames.contains(T.store))return await kt(T.name),await this.init();this.conflictHandler=new Ge(this._db),this.failedHandler=new Ke(this._db);const t=new Qe(y.options.assetsPath+Ze,{});return t.port.onmessage=this._handleWorkerMessage,window.addEventListener("beforeunload",()=>t.port.postMessage({type:"close"})),M._globalHeaders&&t.port.postMessage({type:"headers",data:M._globalHeaders}),this}async addJob(t,e){var a;const r={id:crypto.randomUUID(),url:t,transaction:e,status:p.Pending,createdAt:Date.now(),attempts:0,priority:1};await((a=this._db)==null?void 0:a.add(T.store,r)),await this.updateSyncStatus(r,r.status)}async deleteJob(t){var e;await((e=this._db)==null?void 0:e.delete(T.store,t.id))}async getJobs(){var t;return await((t=this._db)==null?void 0:t.getAll(T.store))}async getJobsForObject(t){var r;const e=await((r=this._db)==null?void 0:r.getAllFromIndex(T.store,T.objectIndex,t));return e.sort((a,s)=>a.createdAt-s.createdAt),e}}const dt={a:["à","á","â","ä"],c:["ç"],e:["è","é","ê"],o:["ö","ó","ò","ô","õ"],oe:["œ"],ss:["ß"],u:["ü"]};class yt{constructor(){m(this,"children");m(this,"isEndOfWord");m(this,"items");this.children={},this.isEndOfWord=!1,this.items=[]}}class er{constructor(t,e){m(this,"root");if(this.root=new yt,!e)return;const r=this.getWordFrequency(t,e);for(const a in r)this.insert(a,r[a].items)}_loadFromJson(t,e){Object.keys(t).forEach(r=>{typeof t[r]=="string"||typeof t[r]=="boolean"||(e.children[r]||(e.children[r]=new yt),t[r].hasOwnProperty("isEndOfWord")&&t[r].isEndOfWord&&(e.children[r].isEndOfWord=!0,e.children[r].items=t[r].items),this._loadFromJson(t[r],e.children[r]))})}loadFromJson(t){return this.root=new yt,this._loadFromJson(t,this.root),this}toJson(){const t=e=>{let r={};for(const a in e.children)r[a]=t(e.children[a]);return e.isEndOfWord&&(r.isEndOfWord=!0,r.items=e.items),r};return t(this.root)}getWordFrequency(t,e){const r={},a=t.getAttributes();return e.forEach(s=>{a==null||a.forEach(i=>{if(!s[i])return;s[i].toString().toLowerCase().split(" ").forEach(d=>{d!==""&&(r[d]?r[d].items.push(s._blitzID):r[d]={items:[s._blitzID]})})})}),r}getVariants(t){const e=dt[t],r=[t];return e&&r.push(...e),r}generateAllPermutations(t,e,r,a,s){if(e===r.length){s.push(t);return}const i=r[e],o=e!==r.length-1?i+r[e+1]:void 0;if(!dt[i]&&!(o&&dt[o])){this.generateAllPermutations(t+i,e+1,r,a,s);return}if(dt[i]){const d=a[i];for(const c of d)this.generateAllPermutations(t+c,e+1,r,a,s)}if(o&&dt[o]){const d=a[o];for(const c of d)this.generateAllPermutations(t+c,e+2,r,a,s)}}normalizeQuery(t){const e=/u|e|a|o|c|ss|oe/g,r=t.toLowerCase().match(e);if(!r)return[t.toLowerCase()];const a={};r.forEach(i=>{a[i]=this.getVariants(i)});const s=[];return this.generateAllPermutations("",0,t,a,s),s}insert(t,e){let r=this.root;for(const a of t)r.children[a]||(r.children[a]=new yt),r=r.children[a];r.isEndOfWord=!0,r.items=e}addToSet(t,e){const r=this.normalizeQuery(t);for(const a of r)this._search(a).forEach(i=>{e.add(i)})}search(t){const e=t==null?void 0:t.toLowerCase().split(" ");let r=new Set;return this.addToSet(e[0],r),e.slice(1).forEach(a=>{const s=new Set;this.addToSet(a,s);for(const i of r)s.has(i)||r.delete(i)}),Array.from(r)}_search(t){let e=this.root;for(const a of t){if(!e.children[a])return[];e=e.children[a]}const r=[];return t===""?this.collectWords(e,"",r):this.collectWords(e,t,r),r}collectWords(t,e,r){t.isEndOfWord&&r.push(...t.items);for(const a in t.children){const s=t.children[a],i=e+a;this.collectWords(s,i,r)}}}function se(n,t,e){var a;let r=!0;for(const s of t){if(!r)return!1;const[i,o,d]=s,c=(a=e==null?void 0:e[i])==null?void 0:a.type;let u=n[i],l=d;switch(typeof u=="string"&&(c==="datetime"||c==="date"||i==="_publishingdate")&&(u=new Date(u).getTime()),typeof l=="string"&&(c==="datetime"||c==="date"||i==="_publishingdate")&&(l=new Date(l).getTime()),o){case"LIKE":const h=`${l}`.startsWith("%"),f=`${l}`.endsWith("%"),w=`${l}`.replaceAll("%","");h===f?r=`${u}`.includes(w):h?r=`${u}`.endsWith(w):f&&(r=`${u}`.startsWith(w));break;case"IN":r=(Array.isArray(l)?l:[l]).includes(u);break;case"=":r=u===l;break;case"!=":r=u!==l;break;case">":r=u>l;break;case"<":r=u<l;break;case">=":r=u>=l;break;case"<=":r=u<=l;break;default:r=!0;break}}return r}class rr{constructor(t){m(this,"model");this.model=t,this.ping()}async ping(){(await this.connect()).close()}async query(t,e){const r=await this.connect(),a=r.transaction("objects","readonly").store,s=Array.from(a.indexNames),i=t.customSort&&s.includes(t.customSort)?t.customSort:s.includes("_sort")?"_sort":"sorted",o=t.customSortDirection==="ASC"?"next":"prev",d=t.pagination!==void 0?o==="next"?IDBKeyRange.lowerBound(t.pagination.toString(),!0):IDBKeyRange.upperBound(t.pagination.toString(),!0):null;let c=await a.index(i).openCursor(d,o);const u=this.model.getAttributesDetails()??void 0;let l=[];for(;c;){if(e&&!e.includes(c.value.blitzID)){c=await c.continue();continue}if(se(c.value,t.conditions??[],u)&&(l.push(c.value),t.limit&&l.length>=t.limit))break;c=await c.continue()}if(r.close(),t.var&&t.var.length>0){const f=["_blitzID","_localID","@permissions","_sort","_clusters","_editURLs","_savetimestamp",...t.var];for(const w of l)for(const v in w)f.includes(v)||delete w[v]}return l}async search(t,e){const r=await this.connect(),a=new er(this.model).loadFromJson(r.get("tree",this.model.getName()));r.close();const s=a.search(t);return t!==""&&s.length===0?[]:this.query({conditions:e},s)}async save(t,e=!1){const r=await this.connect();for(const a of t){let s={...a};const i=await r.get("objects",s._blitzID);if(i)s={...i,...s};else if(e)continue;s._savetimestamp=st(),await r.put("objects",s)}r.close()}async connect(){var a;const t=this.model.getAttributesDetails(),e=["1",!0].includes((a=this.model._attributes.hassort)==null?void 0:a.value);return await Ct(this.model.getName(),1,{upgrade:(s,i,o,d,c)=>{const u=S.getDatabases();if(u.includes(s.name)||(u.push(s.name),S.setDatabases(u)),o!==1)return;s.createObjectStore("tree",{keyPath:"name"});const l=s.createObjectStore("objects",{keyPath:"_blitzID"});if(t)for(const h in t)(t[h].type==="date"||h.includes("_fk"))&&l.createIndex(h,h,{unique:!1});l.createIndex("sorted","_blitzstamp"),e&&l.createIndex("_sort","_sort")}})}async find(t){const e=await this.connect(),r=e.get("objects",t);return e.close(),r}async create(t){const e=await this.connect();await e.put("objects",t),e.close()}async update(t){const e=await this.connect();await e.put("objects",t),e.close()}async delete(t){const e=await this.connect();await e.delete("objects",t),e.close()}}class Ft{constructor(){m(this,"_subscribers");m(this,"_cleanUp",()=>{});this._subscribers=new Set}emit(t){for(const e of this._subscribers)e(t)}subscribe(t){if(typeof t!="function")throw new Error("Subscriber must be a function");return this._subscribers.add(t),()=>{this._subscribers.delete(t),this._cleanUp()}}filterPipe(t){const e=new Ft;return e._cleanUp=this.subscribe(r=>{t(r)&&e.emit(r)}),e}}const It=class It{constructor(t){m(this,"model");this.model=t,y.objects.has(this.model.getName())||y.objects.set(this.model.getName(),new Map)}getAll(){return y.objects.get(this.model.getName())}get(t){return this.getAll().get(t)}update(t){var s;const e=this.getAll();if(!e.has(t._blitzID.value))return e.set(t._blitzID.value,t),t;const r=e.get(t._blitzID.value),a=Object.keys(this.model.getAttributesDetails()??{});for(const i of a){const o=(s=t[i])==null?void 0:s._value;if(o!==void 0){const d=r[i];d&&(d._value=o,d._valueSignal.set(o,!1))}}return r}delete(t){const e=this.getAll();e.has(t)&&e.delete(t)}emit(t){It.channel.emit(t)}async query(t={}){var u;const e=[],r=Array.from(this.getAll().values()).map(l=>l.toObject()),a=this.model.getAttributesDetails()??void 0,s=Object.keys(a??{}),i=["1",!0].includes((u=this.model._attributes.hassort)==null?void 0:u.value),o=t.customSort&&s.includes(t.customSort)?t.customSort:i?"_sort":"_blitzstamp",d=t.customSortDirection??"DESC";r.sort((l,h)=>{try{const f=parseInt(l[o]),w=parseInt(h[o]);if(f<w)return d==="ASC"?-1:1;if(f>w)return d==="ASC"?1:-1}catch{}return 0});for(const l of r){if(t.pagination!==void 0)try{const h=parseInt(l[o]);if(typeof h!="number"||(d==="ASC"?t.pagination>=h:t.pagination<=h))continue}catch{}if(se(l,t.conditions??[],a)&&(e.push(l),t.limit&&e.length>=t.limit))break}if(t.var&&t.var.length>0){const l=["_blitzID","_localID","@permissions","_sort","_clusters","_editURLs","_savetimestamp",...t.var];for(const h of e)for(const f in h)l.includes(f)||delete h[f]}return e}};m(It,"channel",new Ft);let pt=It;class nr{static async send(t,e){try{const r=new URL(t.url).origin!==self.location.origin?"?enableCors=1":"",a=await globalThis.fetch(t.url+"/api/post.json"+r,{method:"POST",headers:{"Content-Type":"application/json",...e??{}},body:JSON.stringify([t.transaction])});if(!a.ok)throw new Error(`HTTP request failed with status ${a.status}`+(a.statusText?`: ${a.statusText}`:""));const s=await a.json();if(!s||!s.results)throw new Error("No response returned!");const i=s.results[t.transaction.hash];if(!i)throw new Error("No result returned for this job!");if(i.s||i.s0||i.s1||i.n)return{status:Z.Success};if(i.conflict){const o=Object.keys(t.transaction.data)[0],d=i.conflict[o];if(!d)throw new Error("No previous value found in conflict result!");return{status:Z.Conflict,message:d}}else if(i.e)return{status:Z.Failed,message:i.e};return{status:Z.Exception,message:s.error??(Array.isArray(s.errors)?s.errors.map(o=>(o==null?void 0:o.message)??o).join(" | "):"Unknown error!")}}catch(r){return{status:Z.Exception,message:r.message}}}}class ht{constructor(t){m(this,"_value");m(this,"_subscribers");this._value=t,this._subscribers=new Set}get(){return this._value}set(t,e=!0){this._value!==t&&(this._value=t,e&&this.emit())}emit(){for(const t of this._subscribers)t(this._value)}subscribe(t,e=!0){if(typeof t!="function")throw new Error("Subscriber must be a function");return this._subscribers.add(t),e&&t(this._value),()=>this._subscribers.delete(t)}}class E{constructor(t,e,r){m(this,"_object");m(this,"_name");m(this,"_type");m(this,"_value");m(this,"_valueSignal");m(this,"_syncSignal");this._name=t,this._type=e,this._value=this.unserialize(r),this._valueSignal=new ht(this._value),this._syncSignal=new ht(null)}get value(){return this._value}set value(t){this._value=this.unserialize(t),this._valueSignal.set(this._value)}withValue(t){return this.value=t,this}withObject(t){return this._object=t,this}async edit(t,e){if(!this._object)throw new Error("Can not edit attribute, object is not set.");return this._object.edit(this._name,t,e)}subscribe(t,e=!0){var a,s;const r=this._valueSignal.subscribe(t,e);return this._value===void 0&&((s=(a=this._object)==null?void 0:a.model)==null||s.get({blitzID:this._object._blitzID.value,forceHttp:!0}).then(i=>{(i==null?void 0:i[this._name]._value)!==void 0&&this._valueSignal.emit()})),r}syncStatus(t){var a;const e=this._syncSignal.get()!==null,r=this._syncSignal.subscribe(t,e);return e||y.queue.getJobsForObject((a=this._object)==null?void 0:a._blitzID.value).then(s=>{const i=s.filter(l=>{var h;return l.transaction.action===x.Edit&&((h=l.transaction.data)==null?void 0:h[this._name])!==void 0});let o=p.Pending,d;const c=i.find(l=>l.status===p.Failed),u=i.find(l=>l.status===p.Conflict);c?(o=p.Failed,d=c):u?(o=p.Conflict,d=u):i.every(l=>l.status===p.Completed)&&(o=p.Completed),this._syncSignal.set({status:o,job:d},!1),t(this._syncSignal.get())}),r}getDetails(){var t,e;return((e=(t=this._object)==null?void 0:t.model)==null?void 0:e.getAttributeDetails(this._name))||null}}class ft extends E{unserialize(t){return t}serialize(){return this._value}}class ie extends E{unserialize(t){if(typeof t=="boolean")return t;if(typeof t=="string"&&["0","1"].includes(t))return t==="1";if(typeof t=="number"&&[0,1].includes(t))return t===1;if(t!==void 0)return null}serialize(){return typeof this._value=="boolean"?this._value?"1":"0":this._value}}const oe=6048e5,ar=864e5,vt=43200,ce=1440,ue=Symbol.for("constructDateFrom");function Q(n,t){return typeof n=="function"?n(t):n&&typeof n=="object"&&ue in n?n[ue](t):n instanceof Date?new n.constructor(t):new Date(t)}function W(n,t){return Q(t||n,n)}let sr={};function mt(){return sr}function gt(n,t){var o,d,c,u;const e=mt(),r=(t==null?void 0:t.weekStartsOn)??((d=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:d.weekStartsOn)??e.weekStartsOn??((u=(c=e.locale)==null?void 0:c.options)==null?void 0:u.weekStartsOn)??0,a=W(n,t==null?void 0:t.in),s=a.getDay(),i=(s<r?7:0)+s-r;return a.setDate(a.getDate()-i),a.setHours(0,0,0,0),a}function _t(n,t){return gt(n,{...t,weekStartsOn:1})}function le(n,t){const e=W(n,t==null?void 0:t.in),r=e.getFullYear(),a=Q(e,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const s=_t(a),i=Q(e,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);const o=_t(i);return e.getTime()>=s.getTime()?r+1:e.getTime()>=o.getTime()?r:r-1}function Dt(n){const t=W(n),e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),+n-+e}function Mt(n,...t){const e=Q.bind(null,n||t.find(r=>typeof r=="object"));return t.map(e)}function de(n,t){const e=W(n,t==null?void 0:t.in);return e.setHours(0,0,0,0),e}function ir(n,t,e){const[r,a]=Mt(e==null?void 0:e.in,n,t),s=de(r),i=de(a),o=+s-Dt(s),d=+i-Dt(i);return Math.round((o-d)/ar)}function or(n,t){const e=le(n,t),r=Q((t==null?void 0:t.in)||n,0);return r.setFullYear(e,0,4),r.setHours(0,0,0,0),_t(r)}function St(n,t){const e=+W(n)-+W(t);return e<0?-1:e>0?1:e}function cr(n){return Q(n,Date.now())}function ur(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function lr(n){return!(!ur(n)&&typeof n!="number"||isNaN(+W(n)))}function dr(n,t,e){const[r,a]=Mt(e==null?void 0:e.in,n,t),s=r.getFullYear()-a.getFullYear(),i=r.getMonth()-a.getMonth();return s*12+i}function hr(n){return t=>{const r=(n?Math[n]:Math.trunc)(t);return r===0?0:r}}function fr(n,t){return+W(n)-+W(t)}function mr(n,t){const e=W(n,t==null?void 0:t.in);return e.setHours(23,59,59,999),e}function gr(n,t){const e=W(n,t==null?void 0:t.in),r=e.getMonth();return e.setFullYear(e.getFullYear(),r+1,0),e.setHours(23,59,59,999),e}function br(n,t){const e=W(n,t==null?void 0:t.in);return+mr(e,t)==+gr(e,t)}function wr(n,t,e){const[r,a,s]=Mt(e==null?void 0:e.in,n,n,t),i=St(a,s),o=Math.abs(dr(a,s));if(o<1)return 0;a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-i*o);let d=St(a,s)===-i;br(r)&&o===1&&St(r,s)===1&&(d=!1);const c=i*(o-+d);return c===0?0:c}function yr(n,t,e){const r=fr(n,t)/1e3;return hr(e==null?void 0:e.roundingMethod)(r)}function pr(n,t){const e=W(n,t==null?void 0:t.in);return e.setFullYear(e.getFullYear(),0,1),e.setHours(0,0,0,0),e}const vr={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},_r=(n,t,e)=>{let r;const a=vr[n];return typeof a=="string"?r=a:t===1?r=a.one:r=a.other.replace("{{count}}",t.toString()),e!=null&&e.addSuffix?e.comparison&&e.comparison>0?"in "+r:r+" ago":r};function X(n){return(t={})=>{const e=t.width?String(t.width):n.defaultWidth;return n.formats[e]||n.formats[n.defaultWidth]}}const Dr={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Mr={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Sr={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Or={date:X({formats:Dr,defaultWidth:"full"}),time:X({formats:Mr,defaultWidth:"full"}),dateTime:X({formats:Sr,defaultWidth:"full"})},zr={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ir=(n,t,e,r)=>zr[n];function F(n){return(t,e)=>{const r=e!=null&&e.context?String(e.context):"standalone";let a;if(r==="formatting"&&n.formattingValues){const i=n.defaultFormattingWidth||n.defaultWidth,o=e!=null&&e.width?String(e.width):i;a=n.formattingValues[o]||n.formattingValues[i]}else{const i=n.defaultWidth,o=e!=null&&e.width?String(e.width):n.defaultWidth;a=n.values[o]||n.values[i]}const s=n.argumentCallback?n.argumentCallback(t):t;return a[s]}}const Tr={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},xr={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Ar={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Pr={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Er={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},jr={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Cr={ordinalNumber:(n,t)=>{const e=Number(n),r=e%100;if(r>20||r<10)switch(r%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"},era:F({values:Tr,defaultWidth:"wide"}),quarter:F({values:xr,defaultWidth:"wide",argumentCallback:n=>n-1}),month:F({values:Ar,defaultWidth:"wide"}),day:F({values:Pr,defaultWidth:"wide"}),dayPeriod:F({values:Er,defaultWidth:"wide",formattingValues:jr,defaultFormattingWidth:"wide"})};function N(n){return(t,e={})=>{const r=e.width,a=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],s=t.match(a);if(!s)return null;const i=s[0],o=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],d=Array.isArray(o)?Wr(o,l=>l.test(i)):kr(o,l=>l.test(i));let c;c=n.valueCallback?n.valueCallback(d):d,c=e.valueCallback?e.valueCallback(c):c;const u=t.slice(i.length);return{value:c,rest:u}}}function kr(n,t){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&t(n[e]))return e}function Wr(n,t){for(let e=0;e<n.length;e++)if(t(n[e]))return e}function Nt(n){return(t,e={})=>{const r=t.match(n.matchPattern);if(!r)return null;const a=r[0],s=t.match(n.parsePattern);if(!s)return null;let i=n.valueCallback?n.valueCallback(s[0]):s[0];i=e.valueCallback?e.valueCallback(i):i;const o=t.slice(a.length);return{value:i,rest:o}}}const Ur=/^(\d+)(th|st|nd|rd)?/i,Lr=/\d+/i,Fr={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Nr={any:[/^b/i,/^(a|c)/i]},Jr={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Rr={any:[/1/i,/2/i,/3/i,/4/i]},$r={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Hr={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Yr={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Br={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Vr={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},qr={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Qr={ordinalNumber:Nt({matchPattern:Ur,parsePattern:Lr,valueCallback:n=>parseInt(n,10)}),era:N({matchPatterns:Fr,defaultMatchWidth:"wide",parsePatterns:Nr,defaultParseWidth:"any"}),quarter:N({matchPatterns:Jr,defaultMatchWidth:"wide",parsePatterns:Rr,defaultParseWidth:"any",valueCallback:n=>n+1}),month:N({matchPatterns:$r,defaultMatchWidth:"wide",parsePatterns:Hr,defaultParseWidth:"any"}),day:N({matchPatterns:Yr,defaultMatchWidth:"wide",parsePatterns:Br,defaultParseWidth:"any"}),dayPeriod:N({matchPatterns:Vr,defaultMatchWidth:"any",parsePatterns:qr,defaultParseWidth:"any"})},it={code:"en-US",formatDistance:_r,formatLong:Or,formatRelative:Ir,localize:Cr,match:Qr,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Xr(n,t){const e=W(n,t==null?void 0:t.in);return ir(e,pr(e))+1}function Gr(n,t){const e=W(n,t==null?void 0:t.in),r=+_t(e)-+or(e);return Math.round(r/oe)+1}function he(n,t){var u,l,h,f;const e=W(n,t==null?void 0:t.in),r=e.getFullYear(),a=mt(),s=(t==null?void 0:t.firstWeekContainsDate)??((l=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:l.firstWeekContainsDate)??a.firstWeekContainsDate??((f=(h=a.locale)==null?void 0:h.options)==null?void 0:f.firstWeekContainsDate)??1,i=Q((t==null?void 0:t.in)||n,0);i.setFullYear(r+1,0,s),i.setHours(0,0,0,0);const o=gt(i,t),d=Q((t==null?void 0:t.in)||n,0);d.setFullYear(r,0,s),d.setHours(0,0,0,0);const c=gt(d,t);return+e>=+o?r+1:+e>=+c?r:r-1}function Kr(n,t){var o,d,c,u;const e=mt(),r=(t==null?void 0:t.firstWeekContainsDate)??((d=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:d.firstWeekContainsDate)??e.firstWeekContainsDate??((u=(c=e.locale)==null?void 0:c.options)==null?void 0:u.firstWeekContainsDate)??1,a=he(n,t),s=Q((t==null?void 0:t.in)||n,0);return s.setFullYear(a,0,r),s.setHours(0,0,0,0),gt(s,t)}function Zr(n,t){const e=W(n,t==null?void 0:t.in),r=+gt(e,t)-+Kr(e,t);return Math.round(r/oe)+1}function _(n,t){const e=n<0?"-":"",r=Math.abs(n).toString().padStart(t,"0");return e+r}const G={y(n,t){const e=n.getFullYear(),r=e>0?e:1-e;return _(t==="yy"?r%100:r,t.length)},M(n,t){const e=n.getMonth();return t==="M"?String(e+1):_(e+1,2)},d(n,t){return _(n.getDate(),t.length)},a(n,t){const e=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return e.toUpperCase();case"aaa":return e;case"aaaaa":return e[0];case"aaaa":default:return e==="am"?"a.m.":"p.m."}},h(n,t){return _(n.getHours()%12||12,t.length)},H(n,t){return _(n.getHours(),t.length)},m(n,t){return _(n.getMinutes(),t.length)},s(n,t){return _(n.getSeconds(),t.length)},S(n,t){const e=t.length,r=n.getMilliseconds(),a=Math.trunc(r*Math.pow(10,e-3));return _(a,t.length)}},ot={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},fe={G:function(n,t,e){const r=n.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return e.era(r,{width:"abbreviated"});case"GGGGG":return e.era(r,{width:"narrow"});case"GGGG":default:return e.era(r,{width:"wide"})}},y:function(n,t,e){if(t==="yo"){const r=n.getFullYear(),a=r>0?r:1-r;return e.ordinalNumber(a,{unit:"year"})}return G.y(n,t)},Y:function(n,t,e,r){const a=he(n,r),s=a>0?a:1-a;if(t==="YY"){const i=s%100;return _(i,2)}return t==="Yo"?e.ordinalNumber(s,{unit:"year"}):_(s,t.length)},R:function(n,t){const e=le(n);return _(e,t.length)},u:function(n,t){const e=n.getFullYear();return _(e,t.length)},Q:function(n,t,e){const r=Math.ceil((n.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return _(r,2);case"Qo":return e.ordinalNumber(r,{unit:"quarter"});case"QQQ":return e.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return e.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return e.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,t,e){const r=Math.ceil((n.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return _(r,2);case"qo":return e.ordinalNumber(r,{unit:"quarter"});case"qqq":return e.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return e.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return e.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,t,e){const r=n.getMonth();switch(t){case"M":case"MM":return G.M(n,t);case"Mo":return e.ordinalNumber(r+1,{unit:"month"});case"MMM":return e.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return e.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return e.month(r,{width:"wide",context:"formatting"})}},L:function(n,t,e){const r=n.getMonth();switch(t){case"L":return String(r+1);case"LL":return _(r+1,2);case"Lo":return e.ordinalNumber(r+1,{unit:"month"});case"LLL":return e.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return e.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return e.month(r,{width:"wide",context:"standalone"})}},w:function(n,t,e,r){const a=Zr(n,r);return t==="wo"?e.ordinalNumber(a,{unit:"week"}):_(a,t.length)},I:function(n,t,e){const r=Gr(n);return t==="Io"?e.ordinalNumber(r,{unit:"week"}):_(r,t.length)},d:function(n,t,e){return t==="do"?e.ordinalNumber(n.getDate(),{unit:"date"}):G.d(n,t)},D:function(n,t,e){const r=Xr(n);return t==="Do"?e.ordinalNumber(r,{unit:"dayOfYear"}):_(r,t.length)},E:function(n,t,e){const r=n.getDay();switch(t){case"E":case"EE":case"EEE":return e.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return e.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return e.day(r,{width:"short",context:"formatting"});case"EEEE":default:return e.day(r,{width:"wide",context:"formatting"})}},e:function(n,t,e,r){const a=n.getDay(),s=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return _(s,2);case"eo":return e.ordinalNumber(s,{unit:"day"});case"eee":return e.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return e.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return e.day(a,{width:"short",context:"formatting"});case"eeee":default:return e.day(a,{width:"wide",context:"formatting"})}},c:function(n,t,e,r){const a=n.getDay(),s=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return _(s,t.length);case"co":return e.ordinalNumber(s,{unit:"day"});case"ccc":return e.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return e.day(a,{width:"narrow",context:"standalone"});case"cccccc":return e.day(a,{width:"short",context:"standalone"});case"cccc":default:return e.day(a,{width:"wide",context:"standalone"})}},i:function(n,t,e){const r=n.getDay(),a=r===0?7:r;switch(t){case"i":return String(a);case"ii":return _(a,t.length);case"io":return e.ordinalNumber(a,{unit:"day"});case"iii":return e.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return e.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return e.day(r,{width:"short",context:"formatting"});case"iiii":default:return e.day(r,{width:"wide",context:"formatting"})}},a:function(n,t,e){const a=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return e.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return e.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return e.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return e.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(n,t,e){const r=n.getHours();let a;switch(r===12?a=ot.noon:r===0?a=ot.midnight:a=r/12>=1?"pm":"am",t){case"b":case"bb":return e.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return e.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return e.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return e.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(n,t,e){const r=n.getHours();let a;switch(r>=17?a=ot.evening:r>=12?a=ot.afternoon:r>=4?a=ot.morning:a=ot.night,t){case"B":case"BB":case"BBB":return e.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return e.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return e.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(n,t,e){if(t==="ho"){let r=n.getHours()%12;return r===0&&(r=12),e.ordinalNumber(r,{unit:"hour"})}return G.h(n,t)},H:function(n,t,e){return t==="Ho"?e.ordinalNumber(n.getHours(),{unit:"hour"}):G.H(n,t)},K:function(n,t,e){const r=n.getHours()%12;return t==="Ko"?e.ordinalNumber(r,{unit:"hour"}):_(r,t.length)},k:function(n,t,e){let r=n.getHours();return r===0&&(r=24),t==="ko"?e.ordinalNumber(r,{unit:"hour"}):_(r,t.length)},m:function(n,t,e){return t==="mo"?e.ordinalNumber(n.getMinutes(),{unit:"minute"}):G.m(n,t)},s:function(n,t,e){return t==="so"?e.ordinalNumber(n.getSeconds(),{unit:"second"}):G.s(n,t)},S:function(n,t){return G.S(n,t)},X:function(n,t,e){const r=n.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return ge(r);case"XXXX":case"XX":return et(r);case"XXXXX":case"XXX":default:return et(r,":")}},x:function(n,t,e){const r=n.getTimezoneOffset();switch(t){case"x":return ge(r);case"xxxx":case"xx":return et(r);case"xxxxx":case"xxx":default:return et(r,":")}},O:function(n,t,e){const r=n.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+me(r,":");case"OOOO":default:return"GMT"+et(r,":")}},z:function(n,t,e){const r=n.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+me(r,":");case"zzzz":default:return"GMT"+et(r,":")}},t:function(n,t,e){const r=Math.trunc(+n/1e3);return _(r,t.length)},T:function(n,t,e){return _(+n,t.length)}};function me(n,t=""){const e=n>0?"-":"+",r=Math.abs(n),a=Math.trunc(r/60),s=r%60;return s===0?e+String(a):e+String(a)+t+_(s,2)}function ge(n,t){return n%60===0?(n>0?"-":"+")+_(Math.abs(n)/60,2):et(n,t)}function et(n,t=""){const e=n>0?"-":"+",r=Math.abs(n),a=_(Math.trunc(r/60),2),s=_(r%60,2);return e+a+t+s}const be=(n,t)=>{switch(n){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},we=(n,t)=>{switch(n){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},tn={p:we,P:(n,t)=>{const e=n.match(/(P+)(p+)?/)||[],r=e[1],a=e[2];if(!a)return be(n,t);let s;switch(r){case"P":s=t.dateTime({width:"short"});break;case"PP":s=t.dateTime({width:"medium"});break;case"PPP":s=t.dateTime({width:"long"});break;case"PPPP":default:s=t.dateTime({width:"full"});break}return s.replace("{{date}}",be(r,t)).replace("{{time}}",we(a,t))}},en=/^D+$/,rn=/^Y+$/,nn=["D","DD","YY","YYYY"];function an(n){return en.test(n)}function sn(n){return rn.test(n)}function on(n,t,e){const r=cn(n,t,e);if(console.warn(r),nn.includes(n))throw new RangeError(r)}function cn(n,t,e){const r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${t}\`) for formatting ${r} to the input \`${e}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const un=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ln=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,dn=/^'([^]*?)'?$/,hn=/''/g,fn=/[a-zA-Z]/;function ye(n,t,e){var u,l,h,f,w,v,z,A;const r=mt(),a=(e==null?void 0:e.locale)??r.locale??it,s=(e==null?void 0:e.firstWeekContainsDate)??((l=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:l.firstWeekContainsDate)??r.firstWeekContainsDate??((f=(h=r.locale)==null?void 0:h.options)==null?void 0:f.firstWeekContainsDate)??1,i=(e==null?void 0:e.weekStartsOn)??((v=(w=e==null?void 0:e.locale)==null?void 0:w.options)==null?void 0:v.weekStartsOn)??r.weekStartsOn??((A=(z=r.locale)==null?void 0:z.options)==null?void 0:A.weekStartsOn)??0,o=W(n,e==null?void 0:e.in);if(!lr(o))throw new RangeError("Invalid time value");let d=t.match(ln).map(L=>{const U=L[0];if(U==="p"||U==="P"){const at=tn[U];return at(L,a.formatLong)}return L}).join("").match(un).map(L=>{if(L==="''")return{isToken:!1,value:"'"};const U=L[0];if(U==="'")return{isToken:!1,value:mn(L)};if(fe[U])return{isToken:!0,value:L};if(U.match(fn))throw new RangeError("Format string contains an unescaped latin alphabet character `"+U+"`");return{isToken:!1,value:L}});a.localize.preprocessor&&(d=a.localize.preprocessor(o,d));const c={firstWeekContainsDate:s,weekStartsOn:i,locale:a};return d.map(L=>{if(!L.isToken)return L.value;const U=L.value;(!(e!=null&&e.useAdditionalWeekYearTokens)&&sn(U)||!(e!=null&&e.useAdditionalDayOfYearTokens)&&an(U))&&on(U,t,String(n));const at=fe[U[0]];return at(o,U,a.localize,c)}).join("")}function mn(n){const t=n.match(dn);return t?t[1].replace(hn,"'"):n}function gn(n,t,e){const r=mt(),a=(e==null?void 0:e.locale)??r.locale??it,s=2520,i=St(n,t);if(isNaN(i))throw new RangeError("Invalid time value");const o=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:i}),[d,c]=Mt(e==null?void 0:e.in,...i>0?[t,n]:[n,t]),u=yr(c,d),l=(Dt(c)-Dt(d))/1e3,h=Math.round((u-l)/60);let f;if(h<2)return e!=null&&e.includeSeconds?u<5?a.formatDistance("lessThanXSeconds",5,o):u<10?a.formatDistance("lessThanXSeconds",10,o):u<20?a.formatDistance("lessThanXSeconds",20,o):u<40?a.formatDistance("halfAMinute",0,o):u<60?a.formatDistance("lessThanXMinutes",1,o):a.formatDistance("xMinutes",1,o):h===0?a.formatDistance("lessThanXMinutes",1,o):a.formatDistance("xMinutes",h,o);if(h<45)return a.formatDistance("xMinutes",h,o);if(h<90)return a.formatDistance("aboutXHours",1,o);if(h<ce){const w=Math.round(h/60);return a.formatDistance("aboutXHours",w,o)}else{if(h<s)return a.formatDistance("xDays",1,o);if(h<vt){const w=Math.round(h/ce);return a.formatDistance("xDays",w,o)}else if(h<vt*2)return f=Math.round(h/vt),a.formatDistance("aboutXMonths",f,o)}if(f=wr(c,d),f<12){const w=Math.round(h/vt);return a.formatDistance("xMonths",w,o)}else{const w=f%12,v=Math.trunc(f/12);return w<3?a.formatDistance("aboutXYears",v,o):w<9?a.formatDistance("overXYears",v,o):a.formatDistance("almostXYears",v+1,o)}}function pe(n,t){return gn(n,cr(n),t)}const ve={lessThanXSeconds:{standalone:{one:"weniger als 1 Sekunde",other:"weniger als {{count}} Sekunden"},withPreposition:{one:"weniger als 1 Sekunde",other:"weniger als {{count}} Sekunden"}},xSeconds:{standalone:{one:"1 Sekunde",other:"{{count}} Sekunden"},withPreposition:{one:"1 Sekunde",other:"{{count}} Sekunden"}},halfAMinute:{standalone:"eine halbe Minute",withPreposition:"einer halben Minute"},lessThanXMinutes:{standalone:{one:"weniger als 1 Minute",other:"weniger als {{count}} Minuten"},withPreposition:{one:"weniger als 1 Minute",other:"weniger als {{count}} Minuten"}},xMinutes:{standalone:{one:"1 Minute",other:"{{count}} Minuten"},withPreposition:{one:"1 Minute",other:"{{count}} Minuten"}},aboutXHours:{standalone:{one:"etwa 1 Stunde",other:"etwa {{count}} Stunden"},withPreposition:{one:"etwa 1 Stunde",other:"etwa {{count}} Stunden"}},xHours:{standalone:{one:"1 Stunde",other:"{{count}} Stunden"},withPreposition:{one:"1 Stunde",other:"{{count}} Stunden"}},xDays:{standalone:{one:"1 Tag",other:"{{count}} Tage"},withPreposition:{one:"1 Tag",other:"{{count}} Tagen"}},aboutXWeeks:{standalone:{one:"etwa 1 Woche",other:"etwa {{count}} Wochen"},withPreposition:{one:"etwa 1 Woche",other:"etwa {{count}} Wochen"}},xWeeks:{standalone:{one:"1 Woche",other:"{{count}} Wochen"},withPreposition:{one:"1 Woche",other:"{{count}} Wochen"}},aboutXMonths:{standalone:{one:"etwa 1 Monat",other:"etwa {{count}} Monate"},withPreposition:{one:"etwa 1 Monat",other:"etwa {{count}} Monaten"}},xMonths:{standalone:{one:"1 Monat",other:"{{count}} Monate"},withPreposition:{one:"1 Monat",other:"{{count}} Monaten"}},aboutXYears:{standalone:{one:"etwa 1 Jahr",other:"etwa {{count}} Jahre"},withPreposition:{one:"etwa 1 Jahr",other:"etwa {{count}} Jahren"}},xYears:{standalone:{one:"1 Jahr",other:"{{count}} Jahre"},withPreposition:{one:"1 Jahr",other:"{{count}} Jahren"}},overXYears:{standalone:{one:"mehr als 1 Jahr",other:"mehr als {{count}} Jahre"},withPreposition:{one:"mehr als 1 Jahr",other:"mehr als {{count}} Jahren"}},almostXYears:{standalone:{one:"fast 1 Jahr",other:"fast {{count}} Jahre"},withPreposition:{one:"fast 1 Jahr",other:"fast {{count}} Jahren"}}},bn=(n,t,e)=>{let r;const a=e!=null&&e.addSuffix?ve[n].withPreposition:ve[n].standalone;return typeof a=="string"?r=a:t===1?r=a.one:r=a.other.replace("{{count}}",String(t)),e!=null&&e.addSuffix?e.comparison&&e.comparison>0?"in "+r:"vor "+r:r},wn={full:"EEEE, do MMMM y",long:"do MMMM y",medium:"do MMM y",short:"dd.MM.y"},yn={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},pn={full:"{{date}} 'um' {{time}}",long:"{{date}} 'um' {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},vn={date:X({formats:wn,defaultWidth:"full"}),time:X({formats:yn,defaultWidth:"full"}),dateTime:X({formats:pn,defaultWidth:"full"})},_n={lastWeek:"'letzten' eeee 'um' p",yesterday:"'gestern um' p",today:"'heute um' p",tomorrow:"'morgen um' p",nextWeek:"eeee 'um' p",other:"P"},Dn=(n,t,e,r)=>_n[n],Mn={narrow:["v.Chr.","n.Chr."],abbreviated:["v.Chr.","n.Chr."],wide:["vor Christus","nach Christus"]},Sn={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1. Quartal","2. Quartal","3. Quartal","4. Quartal"]},Jt={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],wide:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]},On={narrow:Jt.narrow,abbreviated:["Jan.","Feb.","März","Apr.","Mai","Juni","Juli","Aug.","Sep.","Okt.","Nov.","Dez."],wide:Jt.wide},zn={narrow:["S","M","D","M","D","F","S"],short:["So","Mo","Di","Mi","Do","Fr","Sa"],abbreviated:["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."],wide:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"]},In={narrow:{am:"vm.",pm:"nm.",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachm.",evening:"Abend",night:"Nacht"},abbreviated:{am:"vorm.",pm:"nachm.",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht"},wide:{am:"vormittags",pm:"nachmittags",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht"}},Tn={narrow:{am:"vm.",pm:"nm.",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachm.",evening:"abends",night:"nachts"},abbreviated:{am:"vorm.",pm:"nachm.",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachmittags",evening:"abends",night:"nachts"},wide:{am:"vormittags",pm:"nachmittags",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachmittags",evening:"abends",night:"nachts"}},xn={ordinalNumber:n=>Number(n)+".",era:F({values:Mn,defaultWidth:"wide"}),quarter:F({values:Sn,defaultWidth:"wide",argumentCallback:n=>n-1}),month:F({values:Jt,formattingValues:On,defaultWidth:"wide"}),day:F({values:zn,defaultWidth:"wide"}),dayPeriod:F({values:In,defaultWidth:"wide",formattingValues:Tn,defaultFormattingWidth:"wide"})},An=/^(\d+)(\.)?/i,Pn=/\d+/i,En={narrow:/^(v\.? ?Chr\.?|n\.? ?Chr\.?)/i,abbreviated:/^(v\.? ?Chr\.?|n\.? ?Chr\.?)/i,wide:/^(vor Christus|vor unserer Zeitrechnung|nach Christus|unserer Zeitrechnung)/i},jn={any:[/^v/i,/^n/i]},Cn={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](\.)? Quartal/i},kn={any:[/1/i,/2/i,/3/i,/4/i]},Wn={narrow:/^[jfmasond]/i,abbreviated:/^(j[aä]n|feb|mär[z]?|apr|mai|jun[i]?|jul[i]?|aug|sep|okt|nov|dez)\.?/i,wide:/^(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)/i},Un={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^j[aä]/i,/^f/i,/^mär/i,/^ap/i,/^mai/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ln={narrow:/^[smdmf]/i,short:/^(so|mo|di|mi|do|fr|sa)/i,abbreviated:/^(son?|mon?|die?|mit?|don?|fre?|sam?)\.?/i,wide:/^(sonntag|montag|dienstag|mittwoch|donnerstag|freitag|samstag)/i},Fn={any:[/^so/i,/^mo/i,/^di/i,/^mi/i,/^do/i,/^f/i,/^sa/i]},Nn={narrow:/^(vm\.?|nm\.?|Mitternacht|Mittag|morgens|nachm\.?|abends|nachts)/i,abbreviated:/^(vorm\.?|nachm\.?|Mitternacht|Mittag|morgens|nachm\.?|abends|nachts)/i,wide:/^(vormittags|nachmittags|Mitternacht|Mittag|morgens|nachmittags|abends|nachts)/i},Jn={any:{am:/^v/i,pm:/^n/i,midnight:/^Mitte/i,noon:/^Mitta/i,morning:/morgens/i,afternoon:/nachmittags/i,evening:/abends/i,night:/nachts/i}},Rn={ordinalNumber:Nt({matchPattern:An,parsePattern:Pn,valueCallback:n=>parseInt(n)}),era:N({matchPatterns:En,defaultMatchWidth:"wide",parsePatterns:jn,defaultParseWidth:"any"}),quarter:N({matchPatterns:Cn,defaultMatchWidth:"wide",parsePatterns:kn,defaultParseWidth:"any",valueCallback:n=>n+1}),month:N({matchPatterns:Wn,defaultMatchWidth:"wide",parsePatterns:Un,defaultParseWidth:"any"}),day:N({matchPatterns:Ln,defaultMatchWidth:"wide",parsePatterns:Fn,defaultParseWidth:"any"}),dayPeriod:N({matchPatterns:Nn,defaultMatchWidth:"wide",parsePatterns:Jn,defaultParseWidth:"any"})},Ot={code:"de",formatDistance:bn,formatLong:vn,formatRelative:Dn,localize:xn,match:Rn,options:{weekStartsOn:1,firstWeekContainsDate:4}},$n={lessThanXSeconds:{one:"moins d’une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d’une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d’un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu’un an",other:"presque {{count}} ans"}},Hn=(n,t,e)=>{let r;const a=$n[n];return typeof a=="string"?r=a:t===1?r=a.one:r=a.other.replace("{{count}}",String(t)),e!=null&&e.addSuffix?e.comparison&&e.comparison>0?"dans "+r:"il y a "+r:r},Yn={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},Bn={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Vn={full:"{{date}} 'à' {{time}}",long:"{{date}} 'à' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},qn={date:X({formats:Yn,defaultWidth:"full"}),time:X({formats:Bn,defaultWidth:"full"}),dateTime:X({formats:Vn,defaultWidth:"full"})},Qn={lastWeek:"eeee 'dernier à' p",yesterday:"'hier à' p",today:"'aujourd’hui à' p",tomorrow:"'demain à' p'",nextWeek:"eeee 'prochain à' p",other:"P"},Xn=(n,t,e,r)=>Qn[n],Gn={narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jésus-Christ","après Jésus-Christ"]},Kn={narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2ème trim.","3ème trim.","4ème trim."],wide:["1er trimestre","2ème trimestre","3ème trimestre","4ème trimestre"]},Zn={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],wide:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"]},ta={narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},ea={narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"après-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l’après-midi",evening:"du soir",night:"du matin"}},ra=(n,t)=>{const e=Number(n),r=t==null?void 0:t.unit;if(e===0)return"0";const a=["year","week","hour","minute","second"];let s;return e===1?s=r&&a.includes(r)?"ère":"er":s="ème",e+s},na=["MMM","MMMM"],aa={preprocessor:(n,t)=>n.getDate()===1||!t.some(r=>r.isToken&&na.includes(r.value))?t:t.map(r=>r.isToken&&r.value==="do"?{isToken:!0,value:"d"}:r),ordinalNumber:ra,era:F({values:Gn,defaultWidth:"wide"}),quarter:F({values:Kn,defaultWidth:"wide",argumentCallback:n=>n-1}),month:F({values:Zn,defaultWidth:"wide"}),day:F({values:ta,defaultWidth:"wide"}),dayPeriod:F({values:ea,defaultWidth:"wide"})},sa=/^(\d+)(ième|ère|ème|er|e)?/i,ia=/\d+/i,oa={narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jésus-Christ|après Jésus-Christ)/i},ca={any:[/^av/i,/^ap/i]},ua={narrow:/^T?[1234]/i,abbreviated:/^[1234](er|ème|e)? trim\.?/i,wide:/^[1234](er|ème|e)? trimestre/i},la={any:[/1/i,/2/i,/3/i,/4/i]},da={narrow:/^[jfmasond]/i,abbreviated:/^(janv|févr|mars|avr|mai|juin|juill|juil|août|sept|oct|nov|déc)\.?/i,wide:/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i},ha={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},fa={narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},ma={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},ga={narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'après[-\s]midi|du soir|de la nuit)/i},ba={any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},wa={ordinalNumber:Nt({matchPattern:sa,parsePattern:ia,valueCallback:n=>parseInt(n)}),era:N({matchPatterns:oa,defaultMatchWidth:"wide",parsePatterns:ca,defaultParseWidth:"any"}),quarter:N({matchPatterns:ua,defaultMatchWidth:"wide",parsePatterns:la,defaultParseWidth:"any",valueCallback:n=>n+1}),month:N({matchPatterns:da,defaultMatchWidth:"wide",parsePatterns:ha,defaultParseWidth:"any"}),day:N({matchPatterns:fa,defaultMatchWidth:"wide",parsePatterns:ma,defaultParseWidth:"any"}),dayPeriod:N({matchPatterns:ga,defaultMatchWidth:"any",parsePatterns:ba,defaultParseWidth:"any"})},zt={code:"fr",formatDistance:Hn,formatLong:qn,formatRelative:Xn,localize:aa,match:wa,options:{weekStartsOn:1,firstWeekContainsDate:4}},ya=/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}$/;class pa extends E{unserialize(t){if(t==="0000-00-00")return null;const e=t instanceof Date?this.toDateString(t):t;if(e!=null&&ya.test(e))return e;if(t!==void 0)return null}serialize(){return this._value===null?"0000-00-00":this._value}toDateString(t){return!t||!(t instanceof Date)?null:t.toISOString().substring(0,10)}toDateObject(){return this._value?new Date(this._value):null}toFormatted(t="en"){if(!this._value)return null;const e=t==="fr"?zt:t==="de"?Ot:it;return ye(new Date(this._value),"dd MMMM yyyy",{locale:e})}toRelative(t="en"){if(!this._value)return null;const e=t==="fr"?zt:t==="de"?Ot:it;return pe(new Date(this._value),{addSuffix:!0,locale:e})}}class Rt extends E{unserialize(t){return t}serialize(){return this._value}}class va extends E{unserialize(t){return t}serialize(){return this._value}}class _e extends E{unserialize(t){if(typeof t=="number")return t;if(typeof t=="string")return parseInt(t,10);if(t!==void 0)return null}serialize(){return typeof this._value=="number"?this._value.toString():this._value}}class _a extends Rt{}const Da=/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}\s[0-9]{2}\:[0-9]{2}\:[0-9]{2}$/;class Ma extends E{unserialize(t){if(t==="0000-00-00 00:00:00")return null;const e=t instanceof Date?this.toDateString(t):t;if(e!=null&&Da.test(e))return e;if(t!==void 0)return null}serialize(){return this._value===null?"0000-00-00 00:00:00":this._value}toDateString(t){if(!t||!(t instanceof Date))return null;const e=new Date(t);e.setMinutes(e.getMinutes()-e.getTimezoneOffset());const r=e.toISOString();return r.substring(0,10)+" "+r.substring(11,19)}toDateObject(){return this._value?new Date(this._value):null}toFormatted(t="en"){if(!this._value)return null;const e=t==="fr"?zt:t==="de"?Ot:it;return ye(new Date(this._value),"dd MMMM yyyy",{locale:e})}toRelative(t="en"){if(!this._value)return null;const e=t==="fr"?zt:t==="de"?Ot:it;return pe(new Date(this._value),{addSuffix:!0,locale:e})}getTimeStamp(){return this._value?new Date(this._value).getTime():null}getBlitzStamp(){return this._value?Math.floor((new Date(this._value).getTime()-new Date("2021-01-01T00:00:00Z").getTime())/1e3):null}}class Sa extends E{async getObject(t){const e=this.serialize();if(!e)return null;const r=await J.get(this._type),a=r==null?void 0:r.memoryClient().get(e);return a||(await(r==null?void 0:r.get({skipCacheUpdateIfFound:!0,...t,raw:!1,blitzID:e}))??null)}unserialize(t){return t!=null&&typeof t!="string"?null:t}serialize(){return this._value}}class Oa extends E{async toUser(){const t=this.serialize();if(!t)return null;const e=await J.get("0BAUsers"),r=await(e==null?void 0:e.get({blitzID:t,skipCacheUpdateIfFound:!0}));return r?{id:t,username:r.username.value}:null}unserialize(t){return t}serialize(){return this._value}}class $t{constructor(t,e,r){m(this,"_object");m(this,"_name");m(this,"_type");m(this,"_value");m(this,"_valueSignal");m(this,"_syncSignal");this._name=t,this._type=e,this._value=this.unserialize(r),this._valueSignal=new ht(this._value),this._syncSignal=new ht(null)}get value(){return this._value}set value(t){this._value=this.unserialize(t),this._valueSignal.set(this._value)}unserialize(t){let e;try{e=typeof t=="string"?JSON.parse(t):t instanceof Array?t:t===null?[]:void 0,e!==void 0&&!Array.isArray(e)&&(e=[])}catch{}return e&&(e=e.map(r=>H.createType(this._name,this._type,r)),e.forEach(r=>r.withObject(this._object))),e}serialize(){if(this._value!==void 0)return this._value.map(t=>t.serialize())}async performAction(t){var s,i,o,d,c,u,l,h,f,w,v,z;const e=new $({action:"edit",data:{[this._name]:{[t.action]:t.value}},model:(i=(s=this._object)==null?void 0:s.model)==null?void 0:i.getName(),blitzID:(o=this._object)==null?void 0:o._blitzID.value}),r=await V.create().run([e]);if(r[0].status!==C.Success&&r[0].status!==C.Notice)throw new Error(r[0].message??"Unknown Error! Please try again.");for(const A of((c=(d=this._object)==null?void 0:d._editURLs)==null?void 0:c.value)??[])await y.queue.addJob(A,e.toObject());const a=await((l=(u=this._object)==null?void 0:u.model)==null?void 0:l.get({blitzID:this._object._blitzID.value,forceLocal:!0,raw:!0}));a&&Array.isArray(a[this._name])&&(this.value=a[this._name]),(f=(h=this._object)==null?void 0:h.model)==null||f.memoryClient().emit(e),(w=this._object)==null||w.dispatchEvent("edit",e.data),(z=(v=this._object)==null?void 0:v.model)==null||z.setLastTransactionHash(e.hash)}async add(t){await this.performAction({action:"add",value:H.createType(this._name,this._type,t).serialize()})}async remove(t){await this.performAction({action:"remove",value:H.createType(this._name,this._type,t).serialize()})}withObject(t){this._object=t,this._value!==void 0&&this._value.forEach(e=>e.withObject(t))}subscribe(t,e=!0){var a,s;const r=this._valueSignal.subscribe(t,e);return this._value===void 0&&((s=(a=this._object)==null?void 0:a.model)==null||s.get({blitzID:this._object._blitzID.value,forceHttp:!0,query:{manyToMany:"object"}}).then(i=>{(i==null?void 0:i[this._name]._value)!==void 0&&this._valueSignal.emit()})),r}syncStatus(t){var a;const e=this._syncSignal.get()!==null,r=this._syncSignal.subscribe(t,e);return e||y.queue.getJobsForObject((a=this._object)==null?void 0:a._blitzID.value).then(s=>{const i=s.filter(l=>{var h;return l.transaction.action===x.Edit&&((h=l.transaction.data)==null?void 0:h[this._name])!==void 0});let o=p.Pending,d;const c=i.find(l=>l.status===p.Failed),u=i.find(l=>l.status===p.Conflict);c?(o=p.Failed,d=c):u?(o=p.Conflict,d=u):i.every(l=>l.status===p.Completed)&&(o=p.Completed),this._syncSignal.set({status:o,job:d},!1),t(this._syncSignal.get())}),r}getDetails(){var t,e;return((e=(t=this._object)==null?void 0:t.model)==null?void 0:e.getAttributeDetails(this._name))||null}}class De extends $t{unserialize(t){let e;try{e=typeof t=="string"?JSON.parse(t):t instanceof Array?t:t===null?[]:void 0,e!==void 0&&!Array.isArray(e)&&(e=[])}catch{}return e}serialize(){return this._value}async add(t){await this.performAction({action:"add",value:t})}async remove(t){await this.performAction({action:"remove",value:t})}withObject(t){this._object=t}async getObjects(t){const e=this.serialize();if(!Array.isArray(e))return[];const r=await J.get(this._type),a=r==null?void 0:r.memoryClient(),s=[];for(const i of e){if(!i._blitzID)continue;const o=a==null?void 0:a.get(i._blitzID);if(o){s.push(o);continue}const d=await(r==null?void 0:r.get({skipCacheUpdateIfFound:!0,...t,raw:!1,blitzID:i._blitzID}));d&&s.push(d)}return s}}function za(n){return n&&n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Ia(n){return n}function Ta(n,t){t=t||{};const e=t.delimiter||".",r=t.maxDepth,a=t.transformKey||Ia,s={};function i(o,d,c){c=c||1,Object.keys(o).forEach(function(u){const l=o[u],h=t.safe&&Array.isArray(l),f=Object.prototype.toString.call(l),w=za(l),v=f==="[object Object]"||f==="[object Array]",z=d?d+e+a(u):a(u);if(!h&&!w&&v&&Object.keys(l).length&&(!t.maxDepth||c<r))return i(l,z,c+1);s[z]=l})}return i(n),s}class xa extends E{unserialize(t){if(t!==null&&typeof t=="object")return t;if(t!==void 0)return null}serialize(){return this._value}validate(t){let e=!0;try{JSON.parse(t)}catch{e=!1}return e}keys(){return Object.keys(this._value??{})}flat(){return Ta(this._value??{})}groupBy(t){if(typeof t!="function")throw new Error("Callback function is not a function!");return Object.groupBy(this._value??{},t)}}class Aa extends E{unserialize(t){if(typeof t=="string")return{content:t,language:null};if(t!==null&&typeof t=="object"&&t.content)return{content:t.content,language:t.language??null};if(t!==void 0)return null}serialize(){return this._value}getLanguage(){var t;return((t=this._value)==null?void 0:t.language)||null}getContent(){var t;return((t=this._value)==null?void 0:t.content)||null}}class Pa extends E{unserialize(t){return t}serialize(){return this._value}getOptions(){var t,e,r;return((r=(e=(t=this._object)==null?void 0:t.model)==null?void 0:e.getAttributeDetails(this._name))==null?void 0:r.options)??[]}validate(t){return this.getOptions().includes(t)}}class Ht extends E{unserialize(t){if(typeof t=="number")return t;if(typeof t=="string")return parseFloat(t);if(t!==void 0)return null}serialize(){return typeof this._value=="number"?this._value.toString():this._value}}class Ea extends _e{}class ja extends Ht{}class Ca extends Ht{toPercentage(){return this._value!=null?(this._value*100).toString()+"%":null}}const Me=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class ka extends E{unserialize(t){if(t!=null&&Me.test(t))return t;if(t!==void 0)return null}serialize(){return this._value}validate(t){return Me.test(t)}}const Se=/^\+[1-9]{1,3}\-[0-9]{7,14}$/;class Wa extends E{unserialize(t){if(t!=null&&Se.test(t))return t;if(t!==void 0)return null}serialize(){return this._value}validate(t){return Se.test(t)}getCallingCode(){if(!this._value)return null;const t=this._value.split("-");return t.length<2?null:t[0].substring(1)}getPhoneNumber(){if(!this._value)return null;const t=this._value.split("-");return t.length<2?null:t[1]}}const Oe=/^https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&\/=]*)$/;class Ua extends E{unserialize(t){if(t!=null&&Oe.test(t))return t;if(t!==void 0)return null}serialize(){return this._value}validate(t){return Oe.test(t)}getUrlObject(){return this._value?new URL(this._value):null}getOrigin(){return this._value?new URL(this._value).origin:null}getProtocol(){return this._value?new URL(this._value).protocol:null}getPathname(){return this._value?new URL(this._value).pathname:null}getHostname(){return this._value?new URL(this._value).hostname:null}getSearch(){return this._value?new URL(this._value).search:null}}class La extends E{unserialize(t){const e=t instanceof Array?t[0]:t;if(e!==null&&typeof e=="object"&&e.base!=null&&e.version!=null)return t;if(e!==void 0)return null}serialize(){return this._value}getUrl(t){const e=this._value instanceof Array?this._value[0]:this._value;return e!==null&&typeof e=="object"&&e.base!=null&&e[t]!=null?e.base+e[t].substring(1):null}}class Fa extends E{unserialize(t){if(t!==null&&typeof t=="object"&&t.url!=null)return t;if(t!==void 0)return null}serialize(){return this._value}getUrl(){var t;return((t=this._value)==null?void 0:t.url)??null}}class Na extends E{unserialize(t){if(t!==null&&typeof t=="object"&&t.url!=null)return t;if(t!==void 0)return null}serialize(){return this._value}getUrl(){var t;return((t=this._value)==null?void 0:t.url)??null}}class Ja extends E{unserialize(t){if(t!==null&&typeof t=="object"&&t.lat&&t.long)return t;if(t!==void 0)return null}serialize(){return this._value}validate(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!e.lat||!e.long)return!1;const r=parseFloat(e.lat);if(isNaN(r)||r<-90||r>90)return!1;const a=parseFloat(e.long);return!(isNaN(a)||a<-180||a>180)}getFormattedAddress(){if(!this._value)return"";const t=[];this._value.venue&&t.push(this._value.venue),this._value.street&&t.push(this._value.street);const e=[];return this._value.zip&&e.push(this._value.zip),this._value.city&&e.push(this._value.city),e.length>0&&t.push(e.join(" ")),this._value.nation&&t.push(this._value.nation),t.join(", ")}async geocodeAddress(t,e){if(!t)throw new Error("Address is required for geocoding.");if(!e)throw new Error("Google Maps API key is required for geocoding.");try{const a=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(t)}&key=${e}`)).json();if(a.status==="OK"&&a.results&&a.results.length>0){const s=a.results[0].geometry.location;return{lat:s.lat.toString(),long:s.lng.toString()}}return null}catch(r){return console.error("Geocoding error:",r.message),null}}}class H{static createType(t,e,r){return t.endsWith("_fk")?new Sa(t,e,r):t==="_userID"?new Oa(t,e,r):e==="int"||["_blitzstamp"].includes(t)?new _e(t,"int",r):e==="tinyint"?new Ea(t,e,r):e==="double"?new ja(t,e,r):e==="float"?new Ht(t,e,r):e==="percentage"?new Ca(t,e,r):e==="varchar"?new _a(t,e,r):e==="text"?new Rt(t,e,r):e==="htmlText"?new va(t,e,r):e==="enum"?new Pa(t,e,r):e==="json"?new xa(t,e,r):e==="boolean"?new ie(t,e,r):e==="datetime"||["_publishingdate","_modified","_expiration"].includes(t)?new Ma(t,"datetime",r):e==="date"?new pa(t,e,r):e==="code"?new Aa(t,e,r):e==="email"?new ka(t,e,r):e==="phone"?new Wa(t,e,r):e==="url"?new Ua(t,e,r):e==="image"?new La(t,e,r):e==="video"?new Fa(t,e,r):e==="file"?new Na(t,e,r):e==="location"?new Ja(t,e,r):new ft(t,e,r)}static createFrom(t,e,r){return Array.isArray(e)?this.createMany(t,e[0],r):this.createType(t,e,r)}static createMany(t,e,r){return t.endsWith("_mtm")?new De(t,e,r):new $t(t,e,r)}static unserialize(t,e){var s,i,o;const r={},a=[...Object.keys(t),...Object.keys(e)].filter((d,c,u)=>u.indexOf(d)===c);for(const d of a)Array.isArray((s=t[d])==null?void 0:s.type)?r[d]=H.createMany(d,((i=t[d])==null?void 0:i.type[0])??"anonymous",e[d]):r[d]=H.createType(d,((o=t[d])==null?void 0:o.type)??"anonymous",e[d]);return r}static serialize(t){const e={};for(const r in t)e[r]=t[r].serialize();return e}}class rt{constructor({model:t,attributes:e}){m(this,"_model");m(this,"_attributes");m(this,"listeners",new Map);m(this,"editQueue",Promise.resolve());this._model=t,this._attributes=e}get model(){return this._model}getAttribute(t){return this._attributes[t]}hasAttribute(t){return this._attributes.hasOwnProperty(t)}edit(t,e,r){return this.enqueueEditOperation(async()=>{var c,u,l,h;const a=(u=(c=this.model)==null?void 0:c.getAttributeDetails(t))==null?void 0:u.type,s=H.createType(t,a,e).serialize(),i=r?H.createType(t,a,r).serialize():this.getAttribute(t).serialize(),o=new $({action:"edit",data:{[t]:{prev:i,new:s}},model:this.model.getName(),blitzID:this.getAttribute("_blitzID").value}),d=await V.create().run([o]);if(d[0].status!==C.Success&&d[0].status!==C.Notice)throw new Error(d[0].message??"Unknown Error! Please try again.");this._attributes[t].value=s;for(const f of this.getAttribute("_editURLs").value)await y.queue.addJob(f,o.toObject());(l=this.model)==null||l.memoryClient().emit(o),this.dispatchEvent("edit",o.data),(h=this.model)==null||h.setLastTransactionHash(o.hash)})}async delete(){var a,s;const t=new $({action:"delete",model:this.model.getName(),blitzID:this.getAttribute("_blitzID").value}),e=await V.create().run([t]);if(e[0].status!==C.Success)throw new Error(e[0].message??"Unknown Error! Please try again.");const r=(a=this.model)==null?void 0:a.memoryClient();r==null||r.delete(this.getAttribute("_blitzID").value);for(const i of this.getAttribute("_editURLs").value)await y.queue.addJob(i,t.toObject());r==null||r.emit(t),this.dispatchEvent("delete",null),(s=this.model)==null||s.setLastTransactionHash(t.hash)}async addUserPermission(t){if(!t||t.length===0)throw new Error("Users missing!");const e=this.getAttribute("_blitzID").value,r={blitzIDs:[e],users:t.reduce((o,d)=>({...o,[`#${d.id}`]:d.permission}),{})},a=new $({action:"addObjectUserPermission",model:this.model.getName(),blitzID:e,data:r,hash:ut(r)}),s=[];for(const o of this.getAttribute("_editURLs").value)s.push(await nr.send({url:o,transaction:a.toObject()},M._globalHeaders));const i=s.find(o=>o.status!==Z.Success);if(i)throw new Error(i.message)}toObject(){const t={};for(const e in this._attributes)t[e]=this._attributes[e].serialize();return t}addEventListener(t,e){var r;this.listeners.has(t)||this.listeners.set(t,[]),(r=this.listeners.get(t))==null||r.push(e)}removeEventListener(t,e){this.listeners.has(t)&&this.listeners.set(t,this.listeners.get(t).filter(r=>e!==r))}dispatchEvent(t,e){var r;this.listeners.has(t)&&((r=this.listeners.get(t))==null||r.forEach(a=>a(e)))}enqueueEditOperation(t){return new Promise((e,r)=>{this.editQueue=this.editQueue.then(async()=>{try{const a=await t();e(a)}catch(a){r(a)}})})}}class Yt{static transformBlitzDataOptions(t){if(typeof t>"u")throw new Error("Configuration is required.");if(typeof t=="string")t={clusters:this.transformClusterOptions(t)};else if(Array.isArray(t))t={clusters:this.transformClusterOptions(t)};else if(typeof t=="object"&&!Array.isArray(t))t.clusters=this.transformClusterOptions(t.clusters);else throw new Error("Unknown configuration type.");if(t.assetsPath||(t.assetsPath=""),t.sync?typeof t.sync=="string"&&(t.sync={level:t.sync}):t.sync={level:"full"},t.sync.level==="partial")throw new Error("Partial sync type not supported yet!");return t.sync.level==="cache"&&(t.sync.ttl||(t.sync.ttl=30*1e3)),t.sync.level==="full"&&(t.sync.interval||(t.sync.interval=30*1e3)),t.flush||(t.flush={type:["version"]}),t.flush.type.includes("interval")&&(t.flush.interval||(t.flush.interval=30)),t.flush.type.includes("size")&&(t.flush.size||(t.flush.size=128)),t}static transformClusterOptions(t){if(typeof t>"u")throw new Error("Clusters are required.");if(typeof t=="string")t={default:{readURL:[t],addURL:[t]}};else if(Array.isArray(t))t={default:{readURL:t,addURL:t}};else if(typeof t=="object")for(const e of Object.keys(t)){if(typeof t[e]=="string"||Array.isArray(t[e])){const r=Array.isArray(t[e])?t[e]:[t[e]];t[e]={readURL:r,addURL:r};continue}typeof t[e]=="object"&&(typeof t[e].readURL=="string"&&(t[e].readURL=[t[e].readURL]),typeof t[e].addURL=="string"&&(t[e].addURL=[t[e].addURL]))}else throw new Error("Unknown cluster configuration type.");return t}}const Ra={get(n,t){if(Reflect.has(n,t)){const e=Reflect.get(n,t);return e instanceof Function?e.bind(n):e}return n._attributes[t]},set(n,t,e){throw new Error("Setting values directly not supported. Please use `edit` method to change a value for an attribute.")}};class ze{static create(t,e,r){const a=e.getAttributesDetails()??{},s=H.unserialize(a,r),i=new Proxy(new t({model:e,attributes:s}),Ra);for(const o in s)s[o].withObject(i);return e.memoryClient().update(i)}}class Bt extends rt{static async model(){if(typeof this.modelName!="string")throw new Error(`${this.name}.modelName is not a string, please provide a valid model name.`);const t=this.modelName==="_Model"?y._Model:await y._Model.get(this.modelName);return t.setReturnType(this),t}static async get(t){return(await this.model()).get(t)}static async exists(t){return(await this.model()).exists(t)}static async add(t,e=[]){return(await this.model()).add(t,e)}static async list(t={}){return(await this.model()).list(t)}}m(Bt,"modelName");const Tt=class Tt extends Bt{constructor({model:e,attributes:r}){super({model:e,attributes:r});m(this,"clusterManager");m(this,"lastTransactionHash",null);m(this,"returnType",rt);this.clusterManager=y.clusterManager}idbClient(){return new rr(this)}memoryClient(){return new pt(this)}getName(){return this._attributes._blitzID.value}getLastTransactionHash(){return this.lastTransactionHash}setLastTransactionHash(e){this.lastTransactionHash=e}setReturnType(e){this.returnType=e}async exists(e){return!!await this.get(e)}async add(e,r=[]){const a=this.resolveClusters(r),s=this.getAttributesDetails()??{},i=new $({action:"add",data:H.serialize(H.unserialize(s,e)),model:this.getName()}),o=await y.getCurrentUser(),d=i.clone();d.data={...d.data,_userID:o.id};const c=await V.create().run([d]);if(c[0].status!==C.Success)throw new Error(c[0].message??"Unknown Error! Please try again.");for(const u of a)for(const l of u.options.addURL)await y.queue.addJob(l,i.toObject());return this.memoryClient().emit(i),this.setLastTransactionHash(i.hash),ze.create(this.returnType,this,d.data)}async get(e){const r=typeof e=="string"?{blitzID:e}:e,s=(await ct.create().model(this).clusters(this.resolveClusters(r.clusters??[])).raw(r.raw??!1).get(r.blitzID).query({returnType:this.returnType??rt}).forceHttp(r.forceHttp??!1).forceLocal(r.forceLocal??!1).skipCacheUpdateIfFound(r.skipCacheUpdateIfFound??!1).signal(r.signal).getQuery(r.query??{}).perform())[0]??null;if(!s&&this.returnType===Tt)throw new Error(`Model with blitzID "${e}" does not exists or you don't have enough permission to view it.`);return s||null}async list(e={}){return await ct.create().model(this).clusters(this.resolveClusters(e.clusters??[])).raw(e.raw??!1).query({conditions:e.conditions,limit:e.limit,returnType:e.returnType??this.returnType??rt,customSort:e.customSort,customSortDirection:e.customSortDirection,pagination:e.pagination,var:e.var,manyToMany:e.manyToMany}).forceHttp(e.forceHttp??!1).forceLocal(e.forceLocal??!1).skipCacheUpdateIfFound(e.skipCacheUpdateIfFound??!1).signal(e.signal).perform()}subscribeToList(e={},r,a=!1){const s=ct.create().model(this).clusters(this.resolveClusters(e.clusters??[])).raw(e.raw??!1).query({conditions:e.conditions,limit:e.limit,returnType:e.returnType??this.returnType??rt,customSort:e.customSort,customSortDirection:e.customSortDirection,var:e.var,manyToMany:e.manyToMany}).forceHttp(e.forceHttp??!1).forceLocal(e.forceLocal??!1).skipCacheUpdateIfFound(e.skipCacheUpdateIfFound??!1).performSignal(a),i=s.subscribe(r,s.get()!==null),o=pt.channel.filterPipe(d=>d.model===this.getName()).subscribe(d=>{if(d.action===x.Add)this.list({...e,forceLocal:!0}).then(c=>{const u=e.raw?c.findIndex(l=>l._blitzID===d.blitzID):c.findIndex(l=>l.getAttribute("_blitzID").value===d.blitzID);u>-1&&s.set({items:c,update:{action:x.Add,object:c[u],index:u}})});else if(d.action===x.Edit){const c=s.get();if(!c)return;const u=e.raw?c.items.findIndex(l=>l._blitzID===d.blitzID):c.items.findIndex(l=>l.getAttribute("_blitzID").value===d.blitzID);u>-1&&this.list({...e,forceLocal:!0}).then(l=>{const h=e.raw?l.findIndex(f=>f._blitzID===d.blitzID):l.findIndex(f=>f.getAttribute("_blitzID").value===d.blitzID);s.set({items:l,update:{action:x.Edit,object:h>-1?l[h]:c.items[u],index:h>-1?h:u}})})}else if(d.action===x.Delete){const c=s.get();if(!c)return;if(e.raw){const u=c.items.findIndex(l=>l._blitzID===d.blitzID);u>-1&&s.set({items:c.items.filter(l=>l._blitzID!==d.blitzID),update:{action:x.Delete,object:c.items[u],index:u}})}else{const u=c.items.findIndex(l=>l.getAttribute("_blitzID").value===d.blitzID);u>-1&&s.set({items:c.items.filter(l=>l.getAttribute("_blitzID").value!==d.blitzID),update:{action:x.Delete,object:c.items[u],index:u}})}}});return()=>{i(),o()}}async sync(){const e=this.getName();if(e){const r=Date.now()/1e3,a=S.getLastSyncedAt(e)??0,s=30;r-a>s&&await lt.create().run(e)}}getAttributesDetails(){var e;return((e=this._attributes.attributes)==null?void 0:e.value)??null}getAttributeDetails(e){var r,a;return((a=(r=this._attributes.attributes)==null?void 0:r.value)==null?void 0:a[e])??null}resolveClusters(e){return Object.values(e.length===0?this.clusterManager.all():this.clusterManager.get(e))}setClusters(e){this.clusterManager=new Gt;const r=Yt.transformClusterOptions(e);for(const a of Object.keys(r))this.clusterManager.register(a,r[a])}getClusterManager(){return this.clusterManager}static async get(e){return super.get(e)}static async list(e={}){return super.list(e)}};m(Tt,"modelName","_Model");let J=Tt;class Vt{static extractModelName(t){const a=new URL(t).pathname.split("/").filter(s=>s!=="").pop();if(!a&&!(a!=null&&a.endsWith(".json")))throw new Error("Model name not found in the URL.");return a.slice(0,a.indexOf(".json"))}static extractConditions(t){const e=new URL(t);return JSON.parse(e.searchParams.get("conditions")||"[]")}}var Ie={exports:{}},Te={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(e,r){return e<<r|e>>>32-r},rotr:function(e,r){return e<<32-r|e>>>r},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var r=0;r<e.length;r++)e[r]=t.endian(e[r]);return e},randomBytes:function(e){for(var r=[];e>0;e--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(e){for(var r=[],a=0,s=0;a<e.length;a++,s+=8)r[s>>>5]|=e[a]<<24-s%32;return r},wordsToBytes:function(e){for(var r=[],a=0;a<e.length*32;a+=8)r.push(e[a>>>5]>>>24-a%32&255);return r},bytesToHex:function(e){for(var r=[],a=0;a<e.length;a++)r.push((e[a]>>>4).toString(16)),r.push((e[a]&15).toString(16));return r.join("")},hexToBytes:function(e){for(var r=[],a=0;a<e.length;a+=2)r.push(parseInt(e.substr(a,2),16));return r},bytesToBase64:function(e){for(var r=[],a=0;a<e.length;a+=3)for(var s=e[a]<<16|e[a+1]<<8|e[a+2],i=0;i<4;i++)a*8+i*6<=e.length*8?r.push(n.charAt(s>>>6*(3-i)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],a=0,s=0;a<e.length;s=++a%4)s!=0&&r.push((n.indexOf(e.charAt(a-1))&Math.pow(2,-2*s+8)-1)<<s*2|n.indexOf(e.charAt(a))>>>6-s*2);return r}};Te.exports=t})();var $a=Te.exports,qt={utf8:{stringToBytes:function(n){return qt.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(qt.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var t=[],e=0;e<n.length;e++)t.push(n.charCodeAt(e)&255);return t},bytesToString:function(n){for(var t=[],e=0;e<n.length;e++)t.push(String.fromCharCode(n[e]));return t.join("")}}},xe=qt;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Ha=function(n){return n!=null&&(Ae(n)||Ya(n)||!!n._isBuffer)};function Ae(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Ya(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&Ae(n.slice(0,0))}(function(){var n=$a,t=xe.utf8,e=Ha,r=xe.bin,a=function(s,i){s.constructor==String?i&&i.encoding==="binary"?s=r.stringToBytes(s):s=t.stringToBytes(s):e(s)?s=Array.prototype.slice.call(s,0):!Array.isArray(s)&&s.constructor!==Uint8Array&&(s=s.toString());for(var o=n.bytesToWords(s),d=s.length*8,c=1732584193,u=-271733879,l=-1732584194,h=271733878,f=0;f<o.length;f++)o[f]=(o[f]<<8|o[f]>>>24)&16711935|(o[f]<<24|o[f]>>>8)&4278255360;o[d>>>5]|=128<<d%32,o[(d+64>>>9<<4)+14]=d;for(var w=a._ff,v=a._gg,z=a._hh,A=a._ii,f=0;f<o.length;f+=16){var L=c,U=u,at=l,Qt=h;c=w(c,u,l,h,o[f+0],7,-680876936),h=w(h,c,u,l,o[f+1],12,-389564586),l=w(l,h,c,u,o[f+2],17,606105819),u=w(u,l,h,c,o[f+3],22,-1044525330),c=w(c,u,l,h,o[f+4],7,-176418897),h=w(h,c,u,l,o[f+5],12,1200080426),l=w(l,h,c,u,o[f+6],17,-1473231341),u=w(u,l,h,c,o[f+7],22,-45705983),c=w(c,u,l,h,o[f+8],7,1770035416),h=w(h,c,u,l,o[f+9],12,-1958414417),l=w(l,h,c,u,o[f+10],17,-42063),u=w(u,l,h,c,o[f+11],22,-1990404162),c=w(c,u,l,h,o[f+12],7,1804603682),h=w(h,c,u,l,o[f+13],12,-40341101),l=w(l,h,c,u,o[f+14],17,-1502002290),u=w(u,l,h,c,o[f+15],22,1236535329),c=v(c,u,l,h,o[f+1],5,-165796510),h=v(h,c,u,l,o[f+6],9,-1069501632),l=v(l,h,c,u,o[f+11],14,643717713),u=v(u,l,h,c,o[f+0],20,-373897302),c=v(c,u,l,h,o[f+5],5,-701558691),h=v(h,c,u,l,o[f+10],9,38016083),l=v(l,h,c,u,o[f+15],14,-660478335),u=v(u,l,h,c,o[f+4],20,-405537848),c=v(c,u,l,h,o[f+9],5,568446438),h=v(h,c,u,l,o[f+14],9,-1019803690),l=v(l,h,c,u,o[f+3],14,-187363961),u=v(u,l,h,c,o[f+8],20,1163531501),c=v(c,u,l,h,o[f+13],5,-1444681467),h=v(h,c,u,l,o[f+2],9,-51403784),l=v(l,h,c,u,o[f+7],14,1735328473),u=v(u,l,h,c,o[f+12],20,-1926607734),c=z(c,u,l,h,o[f+5],4,-378558),h=z(h,c,u,l,o[f+8],11,-2022574463),l=z(l,h,c,u,o[f+11],16,1839030562),u=z(u,l,h,c,o[f+14],23,-35309556),c=z(c,u,l,h,o[f+1],4,-1530992060),h=z(h,c,u,l,o[f+4],11,1272893353),l=z(l,h,c,u,o[f+7],16,-155497632),u=z(u,l,h,c,o[f+10],23,-1094730640),c=z(c,u,l,h,o[f+13],4,681279174),h=z(h,c,u,l,o[f+0],11,-358537222),l=z(l,h,c,u,o[f+3],16,-722521979),u=z(u,l,h,c,o[f+6],23,76029189),c=z(c,u,l,h,o[f+9],4,-640364487),h=z(h,c,u,l,o[f+12],11,-421815835),l=z(l,h,c,u,o[f+15],16,530742520),u=z(u,l,h,c,o[f+2],23,-995338651),c=A(c,u,l,h,o[f+0],6,-198630844),h=A(h,c,u,l,o[f+7],10,1126891415),l=A(l,h,c,u,o[f+14],15,-1416354905),u=A(u,l,h,c,o[f+5],21,-57434055),c=A(c,u,l,h,o[f+12],6,1700485571),h=A(h,c,u,l,o[f+3],10,-1894986606),l=A(l,h,c,u,o[f+10],15,-1051523),u=A(u,l,h,c,o[f+1],21,-2054922799),c=A(c,u,l,h,o[f+8],6,1873313359),h=A(h,c,u,l,o[f+15],10,-30611744),l=A(l,h,c,u,o[f+6],15,-1560198380),u=A(u,l,h,c,o[f+13],21,1309151649),c=A(c,u,l,h,o[f+4],6,-145523070),h=A(h,c,u,l,o[f+11],10,-1120210379),l=A(l,h,c,u,o[f+2],15,718787259),u=A(u,l,h,c,o[f+9],21,-343485551),c=c+L>>>0,u=u+U>>>0,l=l+at>>>0,h=h+Qt>>>0}return n.endian([c,u,l,h])};a._ff=function(s,i,o,d,c,u,l){var h=s+(i&o|~i&d)+(c>>>0)+l;return(h<<u|h>>>32-u)+i},a._gg=function(s,i,o,d,c,u,l){var h=s+(i&d|o&~d)+(c>>>0)+l;return(h<<u|h>>>32-u)+i},a._hh=function(s,i,o,d,c,u,l){var h=s+(i^o^d)+(c>>>0)+l;return(h<<u|h>>>32-u)+i},a._ii=function(s,i,o,d,c,u,l){var h=s+(o^(i|~d))+(c>>>0)+l;return(h<<u|h>>>32-u)+i},a._blocksize=16,a._digestsize=16,Ie.exports=function(s,i){if(s==null)throw new Error("Illegal argument "+s);var o=n.wordsToBytes(a(s,i));return i&&i.asBytes?o:i&&i.asString?r.bytesToString(o):n.bytesToHex(o)}})();var Ba=Ie.exports;const Va=Xe(Ba);class ct{constructor(){m(this,"_clusters");m(this,"_urls");m(this,"_model");m(this,"_query");m(this,"_raw",!1);m(this,"_forceHttp",!1);m(this,"_forceLocal",!1);m(this,"_skipCacheUpdateIfFound",!1);m(this,"_get");m(this,"_getQuery");m(this,"_signal")}static create(){return new ct}model(t){return this._model=t,this}clusters(t){return this._clusters=t,this}signal(t){return this._signal=t,this}urls(t){return this._urls=t,this}query(t){var r,a;this._query=t;const e=(r=this._model)==null?void 0:r.getAttributesDetails();if((a=this._query)!=null&&a.conditions&&e)for(const s of this._query.conditions){const i=s[0];s.length===3&&e[i]!==void 0&&typeof e[i].type=="string"&&(s[1]==="IN"&&Array.isArray(s[2])?s[2]=s[2].map(o=>H.createType(i,e[i].type,o).serialize()):s[2]=H.createType(i,e[i].type,s[2]).serialize())}return this}raw(t){return this._raw=t,this}forceHttp(t){return this._forceHttp=t,this}forceLocal(t){return this._forceLocal=t,this}skipCacheUpdateIfFound(t){return this._skipCacheUpdateIfFound=t,this}get(t){return this._get=t,this}getQuery(t){return this._getQuery=t,this}convertObjects(t){var r;const e=[];for(const a of t)e.push(ze.create(((r=this._query)==null?void 0:r.returnType)??rt,this._model,a));return e}async perform(){var e;let t=this._forceHttp&&!this._forceLocal?[]:await this.performIndexedDb();if(!this._forceLocal){if(y.options.sync.level==="full"&&t.length===0)t=await this.filterQueuedObjects(this.mergeObjects(await this.performHttp())),t=await this.filterExpiredObjects(t),t.length>0&&await this._model.idbClient().save(t);else if(y.options.sync.level==="cache"){const r=this._skipCacheUpdateIfFound&&t.length>0?!1:this.shouldSendHttpRequest();if(r||t.length===0){const a=await this.filterQueuedObjects(this.mergeObjects(await this.performHttp()));(a.length>0||this._forceHttp)&&(t=await this.filterExpiredObjects(a),t.length>0&&await this._model.idbClient().save(t)),r&&((e=this._model)==null?void 0:e.getName())!=="_Model"&&S.setListCallLastTimeStamp(this.hash(),new Date().getTime())}}}return this._raw?t:this.convertObjects(t)}performSignal(t=!1){const e=new ht(null);return(async()=>{var i;if(!t){e.set({items:await this.perform()});return}const r=await this.performMemory();e.set({items:this._raw?r:this.convertObjects(r),nextSource:"local database"});const a=await this.performIndexedDb();e.set({items:this._raw?a:this.convertObjects(a),nextSource:"server"});let s=await this.filterQueuedObjects(this.mergeObjects(await this.performHttp()));s=await this.filterExpiredObjects(s),s.length>0&&await((i=this._model)==null?void 0:i.idbClient().save(s)),e.set({items:this._raw?s:this.convertObjects(s)})})(),e}async performHttp(){return(await Promise.all(this._urls?this._urls.map(e=>this.performSingleUrlHttp(e)):this._clusters.map(e=>this.performSingleClusterHttp(e)))).flat()}async performSingleClusterHttp(t){var r,a;const e={};for(let s=0;s<t.options.readURL.length;s++){const i=t.getNextReadURL();try{const o=this._get?await tt.get({baseUrl:i,modelName:this._model.getName(),blitzID:this._get,query:this._getQuery},this._signal):await tt.list({endpoint:{baseUrl:i,modelName:this._model.getName(),query:this._query}},this._signal);for(const d of o){d._clusters=[t.name],d._editURLs=JSON.parse(JSON.stringify(t.options.readURL));for(const c in d)if(c.endsWith("_fk")&&d[c]!==null&&typeof d[c]=="object"&&d[c]._blitzID){const u=(a=(r=this._model)==null?void 0:r.getAttributeDetails(c))==null?void 0:a.type;if(u&&u!=="_Model"){const l=await J.get(u);l&&await l.idbClient().save([d[c]],!0)}d[c]=d[c]._blitzID}else c.endsWith("_mtm")&&Array.isArray(d[c])&&(d[c]=d[c].map((u,l)=>({_blitzID:typeof u=="string"?u:u._blitzID,_mtmSort:typeof u=="string"?(d[c].length-l)*15:u._mtmSort})))}return o}catch(o){e[i]=(o==null?void 0:o.stack)??(o==null?void 0:o.message)??o}}throw new Error(`All read URLs failed for cluster "${t.name}". Errors: ${JSON.stringify(e)}`)}async performSingleUrlHttp(t){return(await tt.list({fullUrl:t},this._signal)).map(r=>(r.cluster=[],r._editURLs=[t],r))}async performIndexedDb(){var r,a;const t=this._model.idbClient();if(this._get)return await t.query({conditions:[["_blitzID","=",this._get]],limit:1,var:(r=this._getQuery)==null?void 0:r.var,manyToMany:(a=this._getQuery)==null?void 0:a.manyToMany});const e=this._urls?this._urls.map(s=>Vt.extractConditions(s)).flat():this._query.conditions;return await t.query({...this._query,conditions:e})}async performMemory(){var r,a;const t=this._model.memoryClient();if(this._get)return await t.query({conditions:[["_blitzID","=",this._get]],limit:1,var:(r=this._getQuery)==null?void 0:r.var,manyToMany:(a=this._getQuery)==null?void 0:a.manyToMany});const e=this._urls?this._urls.map(s=>Vt.extractConditions(s)).flat():this._query.conditions;return await t.query({...this._query,conditions:e})}mergeObjects(t){const e=[];for(const r of t){const a=e.find(s=>s._blitzID===r._blitzID);a?(a._clusters=[...a._clusters,...r._clusters].filter((s,i,o)=>o.indexOf(s)===i),a._editURLs=[...a._editURLs,...r._editURLs].filter((s,i,o)=>o.indexOf(s)===i)):e.push(r)}return e}async filterQueuedObjects(t){var a;const e=await y.queue.getJobs(),r=[];for(const s of t)if(!e.find(i=>i.transaction.action===x.Delete&&i.transaction.blitzID===s._blitzID))if(!e.find(i=>i.transaction.action===x.Edit&&i.transaction.blitzID===s._blitzID&&i.status!==p.Completed))r.push(s);else{const i=await((a=this._model)==null?void 0:a.get({blitzID:s._blitzID,raw:!0,forceLocal:!0}));i?r.push(i):r.push(s)}return r}async filterExpiredObjects(t){var a;const e=S.getCurrentUser();if(!e||!e.id)return t;const r=[];try{for(const s of t){if(typeof s._expiration=="string"&&s._expiration!==""&&s._expiration!=="0000-00-00 00:00:00"&&e.id!==s._userID){const i=Date.now(),o=new Date(s._expiration).getTime();if(i>o){await((a=this._model)==null?void 0:a.idbClient().delete(s._blitzID));continue}}r.push(s)}}catch(s){return console.error("Error handling expired objects:",s.stack),t}return r}shouldSendHttpRequest(){var e;if(y.options.sync.level!=="cache"||((e=this._model)==null?void 0:e.getName())==="_Model")return!1;const t=S.getListCallLastTimeStamp(this.hash());return t?new Date().getTime()-t>y.options.sync.ttl:!0}hash(){var t,e;return Va(JSON.stringify({clusters:((t=this._clusters)==null?void 0:t.map(r=>r.name))??[],blitzId:this._get,urls:this._urls,modelName:(e=this._model)==null?void 0:e.getName(),listQuery:this._query,getQuery:this._getQuery}))}}const qa=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Pe=n=>{if(typeof n!="string")throw new TypeError("Invalid argument expected string");const t=n.match(qa);if(!t)throw new Error(`Invalid argument not valid semver ('${n}' received)`);return t.shift(),t},Ee=n=>n==="*"||n==="x"||n==="X",je=n=>{const t=parseInt(n,10);return isNaN(t)?n:t},Qa=(n,t)=>typeof n!=typeof t?[String(n),String(t)]:[n,t],Xa=(n,t)=>{if(Ee(n)||Ee(t))return 0;const[e,r]=Qa(je(n),je(t));return e>r?1:e<r?-1:0},Ce=(n,t)=>{for(let e=0;e<Math.max(n.length,t.length);e++){const r=Xa(n[e]||"0",t[e]||"0");if(r!==0)return r}return 0},Ga=(n,t)=>{const e=Pe(n),r=Pe(t),a=e.pop(),s=r.pop(),i=Ce(e,r);return i!==0?i:a&&s?Ce(a.split("."),s.split(".")):a||s?a?-1:1:0},ke=(n,t,e)=>{Ka(e);const r=Ga(n,t);return We[e].includes(r)},We={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},Ue=Object.keys(We),Ka=n=>{if(typeof n!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof n}`);if(Ue.indexOf(n)===-1)throw new Error(`Invalid operator, expected one of ${Ue.join("|")}`)};class Za{constructor(t){m(this,"options");this.options=t}async perform(){if(this.options.type.includes("version")){const t=S.get("version");if(!t||ke(y.VERSION,t,">")){const e=y.VERSION.split(".")[1],r=t==null?void 0:t.split(".")[1];if(!r||ke(e,r,">")){await this.flush(),S.setLastSyncedAt(Math.floor(Date.now()/1e3)),S.set("version",y.VERSION);return}else S.set("version",y.VERSION)}}if(this.options.type.includes("interval")&&this.options.interval){const t=S.get("lastFlush");if(!t)S.set("lastFlush",Date.now().toString());else if(Math.floor((Date.now()-parseInt(t))/864e5)>=this.options.interval){await this.flush(),S.set("lastFlush",Date.now().toString()),S.setLastSyncedAt(Math.floor(Date.now()/1e3)),S.set("version",y.VERSION);return}}if(this.options.type.includes("size")&&this.options.size&&navigator.storage&&navigator.storage.estimate)try{const t=await navigator.storage.estimate();if(t.usage&&Math.floor(t.usage/1e6)>=this.options.size){await this.flush(),S.setLastSyncedAt(Math.floor(Date.now()/1e3)),S.set("version",y.VERSION);return}}catch(t){console.error("Error getting storage estimate:",t.message)}}async flush(){const t=[...(await indexedDB.databases()).filter(e=>{var r;return(r=e.name)==null?void 0:r.startsWith("bdt")}).map(e=>e.name),...S.getDatabases(),"_Model","_Project","db_master",T.name].filter((e,r,a)=>a.findIndex(s=>s===e)===r);for(const e of t)await kt(e);S.clear()}}const P=class P{static get VERSION(){return"1.2.4"}static async initialize(t){if(this.initialized){console.log("%c⚠️ Warning: Library has already been initialized! Skipping the initialization steps.","background: #FFF3CD; color: #856404; font-weight: bold;"),console.groupCollapsed("%cStack Trace","background: #FFF3CD; color: #856404; font-weight: bold; font-style: italic;"),console.log("Options",t),console.trace(),console.groupEnd();return}this.initialized=!0;const e=Yt.transformBlitzDataOptions(t);this.options=e,e.clusters&&P.setClusters(e.clusters),await new Za(this.options.flush).perform(),await new Lt().ping(),this.queue=await new tr().init(),P._Model=new J({model:void 0,attributes:{_blitzID:new ft("_blitzID","string","_Model"),searchable:new ft("searchable","json",void 0),attributes:new ft("attributes","json",{name:{label:"Name",type:"varchar"},label:{label:"Label",type:"texti18n"},modelpermission:{label:"Model Permission",type:"tinyint"},hasuserpermissions:{label:"Has User Permissions",type:"boolean"},subscriberemails:{label:"Subscriber Emails",type:"text"},haslogs:{label:"Has Logs",type:"boolean"},cache:{label:"Cache",name:"cache",type:"boolean"},hasprojects:{label:"Has Projects",type:"boolean"},attributes:{label:"Attributes",type:"json"},objectpermissionoptions:{label:"Object Permission Options",type:"int"},haspublishingdate:{label:"Has Publishing Date",type:"boolean"}}),_editURLs:new ft("_editURLs","json",[]),haspublishingdate:new ie("haspublishingdate","boolean",!1)}}),P._Model.setReturnType(J),t&&typeof t!="string"&&!Array.isArray(t)&&t.uiManager&&(this.ui=new t.uiManager(this,t.uiManagerSettings));try{await P.getCurrentUser()}catch(r){console.error("Error fetching current user:",r.stack)}if(e.sync.level==="full"){const r=lt.create();await r.run(),r.runAtInterval(e.sync.interval)}else e.sync.level==="cache"&&await lt.create().run(void 0,"delete")}static setClusters(t){t=Yt.transformClusterOptions(t);for(const e of Object.keys(t))P.clusterManager.register(e,t[e])}static async list(t){const e=Vt.extractModelName(t);if(!await P._Model.exists(e))throw new Error(`Model "${e}" does not exist.`);return ct.create().model(await P._Model.get(e)).urls([t]).query({}).perform()}static async uploader(t){return await tt.upload({baseUrl:P.clusterManager.toArray()[0].getNextReadURL(),image:t})}static async uploaderVideo(t){return await tt.uploadVideo({baseUrl:P.clusterManager.toArray()[0].getNextReadURL(),video:t})}static async uploaderFile(t){return await tt.uploadFile({baseUrl:P.clusterManager.toArray()[0].getNextReadURL(),file:t})}static async listProjectUsers(t){if(!t)throw new Error("Project ID required!");const e=S.getProjectUsers(t);if(e!==null&&typeof e=="object"){const o=Date.now(),d=864e5;if(o<e.lastSaved+d)return e.users}const r=j.sanitizeBaseUrl(P.clusterManager.toArray()[0].getNextReadURL()),a=new URL(r).origin!==window.location.origin?"?enableCors=1":"",s=await M.create().url(r+`api/listProjectUsers/${t}.json${a}`).get();if(s.error)throw new Error(s.error);if(s.errors instanceof Array&&s.errors.length>0)throw new Error(s.errors.map(o=>o.message||o).join(" | "));const i={lastSaved:Date.now(),users:(s.users||[]).map(o=>({id:o._blitzID,username:o.username}))};return S.setProjectUsers(t,i),i.users}static async getCurrentUser(){var d;const t=S.getCurrentUser();if(t)return t;const e=j.sanitizeBaseUrl(P.clusterManager.toArray()[0].getNextReadURL()),r=new URL(e).origin!==window.location.origin?"?enableCors=1":"",a=await M.create().url(e+"api/ping.json"+r).get();if(a.error)throw new Error(a.error);if(!a.userhash){const c={id:"public",username:"Public"};return S.setCurrentUser(c),c}const s=await J.get("0BAUsers"),i=await(s==null?void 0:s.get(a.userhash));if(!i||!((d=i.username)!=null&&d.value))throw new Error("Could not get user object!");const o={id:a.userhash,username:i.username.value};return S.setCurrentUser(o),o}static refreshCurrentUser(){S.setCurrentUser(null)}static addEventListener(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}static hasEventListener(t){return this.listeners.has(t)?this.listeners.get(t).length>0:!1}static removeEventListener(t,e){this.listeners.has(t)&&this.listeners.set(t,this.listeners.get(t).filter(r=>e!==r))}static dispatchEvent(t,e){this.listeners.has(t)&&this.listeners.get(t).forEach(r=>r(e))}};m(P,"clusterManager",new Gt),m(P,"_Model"),m(P,"objects",new Map),m(P,"options"),m(P,"queue"),m(P,"ui"),m(P,"listeners",new Map),m(P,"initialized",!1);let y=P;I.BDCustomObject=Bt,I.BDModel=J,I.BDObject=rt,I.BlitzData=y,I.DataType=E,I.HttpRequest=M,I.JobStatus=p,I.LocalStorageRepository=S,I.ManyForeignKeyType=De,I.ManyType=$t,I.TextType=Rt,I.blitzhash=ut,I.blitzstamp=st,I.sleep=ae,Object.defineProperty(I,Symbol.toStringTag,{value:"Module"})});
